---
title: "Compute running time"
output: html_document
---

```{r}
library(tidyverse)
library(anytime)
```

```{r}
read_parallel_log <- function(path) {
  read_tsv(
    path, 
    col_types=cols_only(
      Seq="i",
      Starttime="d",
      JobRuntime="d",
      Exitval="i",
      Signal="i",
      Command="c"
    )
  ) %>%
  transmute(
    started=anytime(Starttime),
    ended=anytime(Starttime+JobRuntime),
    duration=ended-started,
    status=Exitval,
    signal=Signal,
    command=Command
  )
}
```

```sh
for x in 100 200 400 all; do
  ln -fs packages-$x.txt packages.txt 
  ./run-experiment.sh 
  mv experiment.log experiment-$x.log
done
```

```{r}
logs_paths <- c("100", "200", "400", "all") %>% map_chr(~ str_c("experiment-", ., ".log"))
logs <- map_dfr(logs_paths, ~ mutate(read_parallel_log(.), log=.))
logs %>%
  group_by(log) %>%
  summarise(duration=difftime(max(ended), min(started), units = "mins"))
```
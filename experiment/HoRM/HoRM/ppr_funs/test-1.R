library(testthat)

.Random.seed <<- .ext.seed

test_that("ppr_funs", {
    ppr <- stats::ppr
    rock <- structure(list(area = c(4990L, 7002L, 7558L, 7352L, 7943L, 7979L, 9333L, 8209L, 8393L, 6425L, 9364L, 8624L, 10651L, 
        8868L, 9417L, 8874L, 10962L, 10743L, 11878L, 9867L, 7838L, 11876L, 12212L, 8233L, 6360L, 4193L, 7416L, 5246L, 6509L, 
        4895L, 6775L, 7894L, 5980L, 5318L, 7392L, 7894L, 3469L, 1468L, 3524L, 5267L, 5048L, 1016L, 5605L, 8793L, 3475L, 1651L, 
        5514L, 9718L), peri = c(2791.9, 3892.6, 3930.66, 3869.32, 3948.54, 4010.15, 4345.75, 4344.75, 3682.04, 3098.65, 4480.05, 
        3986.24, 4036.54, 3518.04, 3999.37, 3629.07, 4608.66, 4787.62, 4864.22, 4479.41, 3428.74, 4353.14, 4697.65, 3518.44, 
        1977.39, 1379.35, 1916.24, 1585.42, 1851.21, 1239.66, 1728.14, 1461.06, 1426.76, 990.388, 1350.76, 1461.06, 1376.7, 
        476.322, 1189.46, 1644.96, 941.543, 308.642, 1145.69, 2280.49, 1174.11, 597.808, 1455.88, 1485.58), shape = c(0.0903296, 
        0.148622, 0.183312, 0.117063, 0.122417, 0.167045, 0.189651, 0.164127, 0.203654, 0.162394, 0.150944, 0.148141, 0.228595, 
        0.231623, 0.172567, 0.153481, 0.204314, 0.262727, 0.200071, 0.14481, 0.113852, 0.291029, 0.240077, 0.161865, 0.280887, 
        0.179455, 0.191802, 0.133083, 0.225214, 0.341273, 0.311646, 0.276016, 0.197653, 0.326635, 0.154192, 0.276016, 0.176969, 
        0.438712, 0.163586, 0.253832, 0.328641, 0.230081, 0.464125, 0.420477, 0.200744, 0.262651, 0.182453, 0.200447), perm = c(6.3, 
        6.3, 6.3, 6.3, 17.1, 17.1, 17.1, 17.1, 119, 119, 119, 119, 82.4, 82.4, 82.4, 82.4, 58.6, 58.6, 58.6, 58.6, 142, 142, 
        142, 142, 740, 740, 740, 740, 890, 890, 890, 890, 950, 950, 950, 950, 100, 100, 100, 100, 1300, 1300, 1300, 1300, 
        580, 580, 580, 580)), class = "data.frame", row.names = c(NA, -48L))
    ppr.out <- structure(list(call = ppr(formula = log(perm) ~ area + peri + shape, data = rock, nterms = 2, max.terms = 5), 
        mu = 2, ml = 5, p = 3L, q = 1L, gof = 8.28405574083455, gofn = c(0, 8.28405574083455, 5.50638644008423, 4.97941053148986, 
            4.49178224411481), df = 5, edf = c(0, 0), xnames = c("area", "peri", "shape"), ynames = NULL, alpha = structure(c(0.000595745632460417, 
            -0.0016023566413182, 0.9999985387691, 5.48855397031835e-05, -9.17841940342749e-05, 0.99999999428162), .Dim = c(3L, 
            2L), .Dimnames = list(c("area", "peri", "shape"), c("term 1", "term 2"))), beta = structure(c(1.6273943493761, 
            0.550667898934466), names = c("term 1", "term 2")), yb = 5.10746252063454, ys = 1.62616724343998, fitted.values = structure(c(1.74585917623053, 
            1.87773976547593, 2.51997399017666, 2.03541941854235, 2.81917312776545, 2.62870530078217, 3.61293922049777, 2.37405240360554, 
            4.50689761905781, 4.17625204640101, 3.93810905564224, 4.68388913953199, 4.7164365141055, 4.3816785251943, 4.53450840248474, 
            4.84504388587902, 4.10276072642743, 3.45492202147548, 4.07065324662886, 4.50972481245067, 4.73248550608468, 5.0217373134923, 
            4.55321447074512, 5.17537444725957, 5.87106529874476, 6.37043184102176, 6.77925936128041, 6.95916429975503, 6.32661605635634, 
            6.62233515493174, 6.82798886871934, 6.75023007856485, 6.70707752094689, 6.92967986329835, 6.80896018367258, 6.75023007856485, 
            5.03221360402327, 5.17518375376016, 5.91096752294623, 5.45826254721929, 6.91190974811634, 6.70341791750806, 7.08021192061868, 
            7.11887437047194, 6.29017104145001, 5.81446522617642, 6.57501255799072, 6.36692203838264), names = c("1", "2", 
            "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", 
            "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "40", "41", 
            "42", "43", "44", "45", "46", "47", "48")), residuals = structure(c(0.0946904571669587, -0.0371901320784438, 
            -0.679424356779174, -0.194869785144862, 0.0199053357431627, 0.21037316272644, -0.773860756989158, 0.465026059903071, 
            0.272225874053721, 0.602871446710521, 0.841014437469285, 0.0952343535795412, -0.304851077190071, 0.0299069117211301, 
            -0.122922965569319, -0.433458448963595, -0.0320260298444586, 0.615812675107484, 8.14499541093028e-05, -0.438990115867705, 
            0.223341551516581, -0.0659102558910414, 0.402612586856143, -0.219547389658314, 0.735584887453457, 0.236218345176456, 
            -0.172609175082195, -0.352514113556819, 0.464605406369849, 0.168886307794444, -0.0367674059931549, 0.0409913841613401, 
            0.149384463647692, -0.0732178787037636, 0.0475018009220065, 0.106231906029741, -0.42704341803518, -0.570013567772071, 
            -1.30579733695814, -0.853092361231198, 0.258209795333287, 0.466701625941573, 0.0899076228309434, 0.0512451729776853, 
            0.0728570620904518, 0.548562877364049, -0.211984454450258, -0.00389393484217138), names = c("1", "2", "3", "4", 
            "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", 
            "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "40", "41", "42", 
            "43", "44", "45", "46", "47", "48")), smod = c(2, 3, 1, 48, 2, 5.10746252063454, 1.62616724343998, 0.000595745632460417, 
            -0.0016023566413182, 0.9999985387691, 5.48855397031835e-05, -9.17841940342749e-05, 0.99999999428162, 1.00075460008254, 
            0.338629314516008, -1.37098758426086, -1.86125914244572, -1.59340742576895, -1.67818204614216, -1.44304583279017, 
            -1.47726746559075, -1.14611956464998, -1.85265928608952, -0.362927321517633, -0.677729047625147, -1.4190608085983, 
            -0.924008078311936, -0.0106983256981078, -0.178455313872375, -0.3752000110372, -0.3131337681673, -0.356942771639277, 
            -0.74515244063062, -0.362362399443327, -1.02891695717767, -0.364256004762267, 0.170758751212883, -0.100330111818508, 
            -0.376708581615868, 0.699936855948582, 0.211110118968345, 1.27591140950263, 0.437042806835855, 1.01033995366015, 
            1.17297964123754, 1.2913148181235, 1.21206918420786, 1.26143880790971, 1.35483725645315, 1.27955239422492, 1.21206918420786, 
            -0.0631017072610779, 0.282395022905134, 0.168061856729624, 0.488237922295649, 1.34978768212068, 0.161577663716063, 
            1.35343433073209, 1.35844750743364, 0.178430968931048, 0.140339612759069, 1.04901466469843, 0.962823582100322, 
            -2.05289957686027, -0.364503077819168, 0.010194366701413, -0.619210096749412, 0.109167869455786, -0.135581707191016, 
            0.673119322555823, 0.511373800828309, -0.018049044304128, 0.31184303390839, 2.07024611121801, 1.96153098157755, 
            -0.678477195534903, -0.790615953591316, 0.0683610934482266, 0.448861265813881, -0.769638370805312, -0.798818359857439, 
            -0.811928121451023, 1.95529090398723, 0.395539942945707, -0.660320012617758, -0.709994887300007, 1.23661710629191, 
            -0.681845640370732, 1.66962684307741, -0.734769864497508, 2.0710500594771, -0.771913519266584, -0.71554526157855, 
            -0.691800068484364, -0.598812794681747, -0.823079370779819, -0.69486010270919, -0.691594105614595, -0.598812794681747, 
            0.049834837430143, -0.711584663279523, 0.96247136858675, -0.805849787447164, -0.712207157921766, 2.42070551513162, 
            -0.417351333799518, -0.361956722136574, 1.62045213085788, 0.869153283985234, -0.435127053620426, -0.558293192326817, 
            -1.41051933291121, -1.91730076067845, -1.61236193348913, -1.70304588059243, -1.47254491275698, -1.50519132787183, 
            -1.2136966633794, -1.90723636032714, -0.696194451944507, -0.975082955357595, -1.4491319891423, -1.10152702001784, 
            0.105904720359254, -0.12245982821879, -0.625713711869259, -0.374936898126083, -0.649839634096379, -1.0086527574904, 
            -0.517877891817914, -1.15458041880107, -0.71075820949268, 0.390820916251431, -0.011988363289764, -0.571157145555138, 
            0.901344813031292, 0.467205541479077, 1.53935143969986, 0.717956127143654, 1.13662335462053, 1.27106993823857, 
            1.57872559840493, 2.63769242495506, 1.47403323172947, 1.90785500685349, 2.39354423301032, 2.63769242495506, 0.0376459523098483, 
            0.550028227286394, 0.357054239171245, 0.755811294559067, 1.82727679330314, 0.340803667888585, 1.967474611355, 
            2.00470943485072, 0.389616823328501, 0.288325036365241, 1.13455516381844, 3.60947378414149, 0.107956151278055, 
            0.175651394453995, 0.23736444790565, 0.165439069567694, 0.195959279650264, 0.236908334629927, 0.303026579740865, 
            0.215903017454477, 0.326355259762287, 0.230626498820018, 0.253694414434202, 0.25560006792594, 0.442690311484302, 
            0.395447498782983, 0.322345174303218, 0.307444013404422, 0.382967141379951, 0.412934508486552, 0.405542927144931, 
            0.275226582824162, 0.229340722089424, 0.543300221432429, 0.479169190377314, 0.29080046779275, 0.448465883464594, 
            0.282987538908079, 0.422952617365773, 0.275496043616061, 0.412552158801972, 0.496156520919025, 0.524879592628566, 
            0.575180234302848, 0.39491450961444, 0.527614333912489, 0.435927490670467, 0.575180234302848, 0.241007636291381, 
            0.475565138904757, 0.247829013542563, 0.391932808346539, 0.519284437138763, 0.257516249807617, 0.666602214119172, 
            0.693772611552422, 0.28370650926305, 0.298397699080776, 0.351465092469398, 0.597471910715867), terms = log(perm) ~ 
            area + peri + shape, xlevels = structure(list(), names = character())), class = c("ppr.form", "ppr"))
    expect_equal(HoRM:::ppr_funs(obj = ppr.out), list(x = structure(c(-1.41051933291121, -1.91730076067845, -1.61236193348913, 
        -1.70304588059243, -1.47254491275698, -1.50519132787183, -1.2136966633794, -1.90723636032714, -0.696194451944507, 
        -0.975082955357595, -1.4491319891423, -1.10152702001784, 0.105904720359254, -0.12245982821879, -0.625713711869259, 
        -0.374936898126083, -0.649839634096379, -1.0086527574904, -0.517877891817914, -1.15458041880107, -0.71075820949268, 
        0.390820916251431, -0.011988363289764, -0.571157145555138, 0.901344813031292, 0.467205541479077, 1.53935143969986, 
        0.717956127143654, 1.13662335462053, 1.27106993823857, 1.57872559840493, 2.63769242495506, 1.47403323172947, 1.90785500685349, 
        2.39354423301032, 2.63769242495506, 0.0376459523098483, 0.550028227286394, 0.357054239171245, 0.755811294559067, 
        1.82727679330314, 0.340803667888585, 1.967474611355, 2.00470943485072, 0.389616823328501, 0.288325036365241, 1.13455516381844, 
        3.60947378414149, 0.107956151278055, 0.175651394453995, 0.23736444790565, 0.165439069567694, 0.195959279650264, 0.236908334629927, 
        0.303026579740865, 0.215903017454477, 0.326355259762287, 0.230626498820018, 0.253694414434202, 0.25560006792594, 
        0.442690311484302, 0.395447498782983, 0.322345174303218, 0.307444013404422, 0.382967141379951, 0.412934508486552, 
        0.405542927144931, 0.275226582824162, 0.229340722089424, 0.543300221432429, 0.479169190377314, 0.29080046779275, 
        0.448465883464594, 0.282987538908079, 0.422952617365773, 0.275496043616061, 0.412552158801972, 0.496156520919025, 
        0.524879592628566, 0.575180234302848, 0.39491450961444, 0.527614333912489, 0.435927490670467, 0.575180234302848, 
        0.241007636291381, 0.475565138904757, 0.247829013542563, 0.391932808346539, 0.519284437138763, 0.257516249807617, 
        0.666602214119172, 0.693772611552422, 0.28370650926305, 0.298397699080776, 0.351465092469398, 0.597471910715867), 
        .Dim = c(48L, 2L)), y = structure(c(-1.37098758426086, -1.86125914244572, -1.59340742576895, -1.67818204614216, -1.44304583279017, 
        -1.47726746559075, -1.14611956464998, -1.85265928608952, -0.362927321517633, -0.677729047625147, -1.4190608085983, 
        -0.924008078311936, -0.0106983256981078, -0.178455313872375, -0.3752000110372, -0.3131337681673, -0.356942771639277, 
        -0.74515244063062, -0.362362399443327, -1.02891695717767, -0.364256004762267, 0.170758751212883, -0.100330111818508, 
        -0.376708581615868, 0.699936855948582, 0.211110118968345, 1.27591140950263, 0.437042806835855, 1.01033995366015, 
        1.17297964123754, 1.2913148181235, 1.21206918420786, 1.26143880790971, 1.35483725645315, 1.27955239422492, 1.21206918420786, 
        -0.0631017072610779, 0.282395022905134, 0.168061856729624, 0.488237922295649, 1.34978768212068, 0.161577663716063, 
        1.35343433073209, 1.35844750743364, 0.178430968931048, 0.140339612759069, 1.04901466469843, 0.962823582100322, -2.05289957686027, 
        -0.364503077819168, 0.010194366701413, -0.619210096749412, 0.109167869455786, -0.135581707191016, 0.673119322555823, 
        0.511373800828309, -0.018049044304128, 0.31184303390839, 2.07024611121801, 1.96153098157755, -0.678477195534903, 
        -0.790615953591316, 0.0683610934482266, 0.448861265813881, -0.769638370805312, -0.798818359857439, -0.811928121451023, 
        1.95529090398723, 0.395539942945707, -0.660320012617758, -0.709994887300007, 1.23661710629191, -0.681845640370732, 
        1.66962684307741, -0.734769864497508, 2.0710500594771, -0.771913519266584, -0.71554526157855, -0.691800068484364, 
        -0.598812794681747, -0.823079370779819, -0.69486010270919, -0.691594105614595, -0.598812794681747, 0.049834837430143, 
        -0.711584663279523, 0.96247136858675, -0.805849787447164, -0.712207157921766, 2.42070551513162, -0.417351333799518, 
        -0.361956722136574, 1.62045213085788, 0.869153283985234, -0.435127053620426, -0.558293192326817), .Dim = c(48L, 2L))))
})

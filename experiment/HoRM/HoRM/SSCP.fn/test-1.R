library(testthat)

.Random.seed <<- .ext.seed

test_that("SSCP.fn", {
    amit <- structure(list(TOT = c(3389, 1101, 1131, 596, 896, 1767, 807, 1111, 645, 628, 1360, 652, 860, 500, 781, 1070, 
        1754), AMI = c(3149, 653, 810, 448, 844, 1450, 493, 941, 547, 392, 1283, 458, 722, 384, 501, 405, 1520), GEN = structure(c(2L, 
        2L, 1L, 2L, 2L, 2L, 2L, 1L, 2L, 2L, 2L, 2L, 2L, 1L, 1L, 1L, 2L), .Label = c("0", "1"), class = "factor"), AMT = c(7500, 
        1975, 3600, 675, 750, 2500, 350, 1500, 375, 1050, 3000, 450, 1750, 2000, 4500, 1500, 3000), PR = c(220, 200, 205, 
        160, 185, 180, 154, 200, 137, 167, 180, 160, 135, 160, 180, 170, 180), DIAP = c(0, 0, 60, 60, 70, 60, 80, 70, 60, 
        60, 60, 64, 90, 60, 0, 90, 0), QRS = c(140, 100, 111, 120, 83, 80, 98, 93, 105, 74, 80, 60, 79, 80, 100, 120, 129)), 
        row.names = c(NA, -17L), class = "data.frame")
    manova <- stats::manova
    fits <- structure(list(coefficients = structure(c(-2879.47824607307, 675.650780500053, 0.284851062570681, 10.2721328378742, 
        7.25117135603652, 7.59823965147683, -2728.70854443674, 763.029761658268, 0.306373400189666, 8.89619768090217, 7.20555971975209, 
        4.98705075425198), .Dim = c(6L, 2L), .Dimnames = list(c("(Intercept)", "GEN1", "AMT", "PR", "DIAP", "QRS"), c("TOT", 
        "AMI"))), residuals = structure(c(132.821720753833, -72.003915726598, -399.247693621709, -382.847295261473, -152.391292356851, 
        366.786444848623, 4.49994231300284, 294.55680213231, 101.840673552989, -180.052349622664, -182.639086436717, 164.133887481394, 
        -74.2661815486472, 123.3054133915, -230.159411460032, 211.54488955793, 274.117452003109, 161.527685962224, -264.353294201753, 
        -373.852437738098, -247.294564989265, 15.7877686837583, 217.132056216631, -83.7421016437088, 462.724007443725, 223.035763042164, 
        -251.053639131114, -103.054643878202, 102.04025642952, -91.9387388388328, 245.272471587775, -248.992414404347, -85.1516268890552, 
        321.913452348577), .Dim = c(17L, 2L), .Dimnames = list(c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", 
        "12", "13", "14", "15", "16", "17"), c("TOT", "AMI"))), effects = structure(c(-4619.81858569207, -537.269130536504, 
        2370.00543337047, 584.066801986851, -530.069163543702, 555.194294506215, 231.311226523512, 295.477043356612, 352.305306973564, 
        -151.580976565716, -261.358764583076, 184.354816713925, 37.077830267667, 87.7386462277604, -453.947734511897, 411.238553256698, 
        309.107248181672, -3638.03437554499, -729.645232757862, 2336.09468401602, 476.457795609546, -565.818546003305, 364.397841101979, 
        106.009161182313, 483.998896534079, 459.399646224059, -171.000485603635, -186.649246615623, 201.640257527298, -63.4903364561169, 
        232.274032392026, -388.482059546239, 5.86068190219283, 412.910622781553), .Dim = c(17L, 2L), .Dimnames = list(c("(Intercept)", 
        "GEN1", "AMT", "PR", "DIAP", "QRS", "", "", "", "", "", "", "", "", "", "", ""), c("TOT", "AMI"))), rank = 6L, fitted.values = structure(c(3256.17827924617, 
        1173.0039157266, 1530.24769362171, 978.847295261473, 1048.39129235685, 1400.21355515138, 802.500057686997, 816.44319786769, 
        543.159326447011, 808.052349622664, 1542.63908643672, 487.866112518606, 934.266181548647, 376.6945866085, 1011.15941146003, 
        858.45511044207, 1479.88254799689, 2987.47231403778, 917.353294201753, 1183.8524377381, 695.294564989265, 828.212231316242, 
        1232.86794378337, 576.742101643709, 478.275992556275, 323.964236957836, 643.053639131114, 1386.0546438782, 355.95974357048, 
        813.938738838833, 138.727528412225, 749.992414404347, 490.151626889055, 1198.08654765142), .Dim = c(17L, 2L), .Dimnames = list(c("1", 
        "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17"), c("TOT", "AMI"))), assign = 0:5, 
        qr = structure(list(qr = structure(c(-4.12310562561766, 0.242535625036333, 0.242535625036333, 0.242535625036333, 
            0.242535625036333, 0.242535625036333, 0.242535625036333, 0.242535625036333, 0.242535625036333, 0.242535625036333, 
            0.242535625036333, 0.242535625036333, 0.242535625036333, 0.242535625036333, 0.242535625036333, 0.242535625036333, 
            0.242535625036333, -2.910427500436, -1.87867287325545, -0.406293396625878, 0.125997250796499, 0.125997250796499, 
            0.125997250796499, 0.125997250796499, -0.406293396625878, 0.125997250796499, 0.125997250796499, 0.125997250796499, 
            0.125997250796499, 0.125997250796499, -0.406293396625878, -0.406293396625878, -0.406293396625878, 0.125997250796499, 
            -8846.48692320025, 1262.62472690043, 7204.50018506951, 0.310696516778138, 0.300286356729085, 0.0573826222512002, 
            0.355807210324031, 0.358804206097419, 0.352337156974347, 0.258645716532877, -0.0120184447424812, 0.341926996925294, 
            0.161484222741722, 0.289403139103738, -0.0576021958646698, 0.358804206097419, -0.0120184447424812, -721.058413233018, 
            21.6047380424377, 59.3396473062725, 68.0867553755294, -0.192988496368093, 0.0139445731868668, 0.231799296848128, 
            -0.408701532720893, 0.483387854642072, 0.0942653604166797, 0.0520866726546236, 0.151304851040306, 0.617652916745527, 
            0.216926338089349, 0.113893949756891, 0.031912795785971, 0.0520866726546236, -214.401492532118, 10.6458129484475, 
            -84.8555279287245, -21.8941685868276, -89.0777830241396, 0.216089642219713, 0.131858533754144, -0.12966225993388, 
            -0.141438211103699, 0.021584654905775, 0.269593635902866, -0.0189004731118439, 0.336429253345524, -0.309476336785805, 
            -0.654996678924626, 0.00406814116648053, -0.403974991009866, -400.668852560022, 9.64385408271132, 42.582644012203, 
            5.71566262485133, 15.2468348583424, 73.0688054039339, -0.0841481994208937, -0.0276272893106824, -0.0449756089024792, 
            0.287104466692042, 0.281864391257653, 0.458222352795712, 0.336049670693035, 0.398869792624691, 0.370240556932071, 
            -0.31141033221205, -0.226680011936502), .Dim = c(17L, 6L), .Dimnames = list(c("1", "2", "3", "4", "5", "6", "7", 
            "8", "9", "10", "11", "12", "13", "14", "15", "16", "17"), c("(Intercept)", "GEN1", "AMT", "PR", "DIAP", "QRS")), 
            assign = 0:5, contrasts = list(GEN = "contr.treatment")), qraux = c(1.24253562503633, 1.1259972507965, 1.06731972472396, 
            1.1684687958008, 1.156219181237, 1.24662519763708), pivot = 1:6, tol = 1e-07, rank = 6L), class = "qr"), df.residual = 11L, 
        contrasts = list(GEN = "contr.treatment"), xlevels = list(GEN = c("0", "1")), call = manova(cbind(TOT, AMI) ~ ., 
            data = amit), terms = cbind(TOT, AMI) ~ GEN + AMT + PR + DIAP + QRS, model = structure(list(`cbind(TOT, AMI)` = structure(c(3389, 
            1101, 1131, 596, 896, 1767, 807, 1111, 645, 628, 1360, 652, 860, 500, 781, 1070, 1754, 3149, 653, 810, 448, 844, 
            1450, 493, 941, 547, 392, 1283, 458, 722, 384, 501, 405, 1520), .Dim = c(17L, 2L), .Dimnames = list(NULL, c("TOT", 
            "AMI"))), GEN = structure(c(2L, 2L, 1L, 2L, 2L, 2L, 2L, 1L, 2L, 2L, 2L, 2L, 2L, 1L, 1L, 1L, 2L), .Label = c("0", 
            "1"), class = "factor"), AMT = c(7500, 1975, 3600, 675, 750, 2500, 350, 1500, 375, 1050, 3000, 450, 1750, 2000, 
            4500, 1500, 3000), PR = c(220, 200, 205, 160, 185, 180, 154, 200, 137, 167, 180, 160, 135, 160, 180, 170, 180), 
            DIAP = c(0, 0, 60, 60, 70, 60, 80, 70, 60, 60, 60, 64, 90, 60, 0, 90, 0), QRS = c(140, 100, 111, 120, 83, 80, 
                98, 93, 105, 74, 80, 60, 79, 80, 100, 120, 129)), terms = cbind(TOT, AMI) ~ GEN + AMT + PR + DIAP + QRS, 
            row.names = c(NA, 17L), class = "data.frame")), class = c("manova", "maov", "aov", "mlm", "lm"))
    expect_equal(HoRM:::SSCP.fn(fits = fits), list(SSCPR = structure(c(6835931.92480833, 6709090.70046083, 6709090.70046083, 
        6669668.98297237), .Dim = c(2L, 2L), .Dimnames = list(c("TOT", "AMI"), c("TOT", "AMI"))), SSCPE = structure(c(870008.310485777, 
        765676.476009757, 765676.476009757, 940708.899380568), .Dim = c(2L, 2L), .Dimnames = list(c("TOT", "AMI"), c("TOT", 
        "AMI"))), SSCPTO = structure(c(7705940.23529411, 7474767.17647058, 7474767.17647058, 7610377.88235294), .Dim = c(2L, 
        2L), .Dimnames = list(c("TOT", "AMI"), c("TOT", "AMI")))))
})

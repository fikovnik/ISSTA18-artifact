library(testthat)

.Random.seed <<- .ext.seed

test_that("cv.gam", {
    Y <- structure(c(4.54421574756145, 1.01002196032835, 0.682949684012769, 3.48006893842528, -1.61542713566318, 6.95880561644061, 
        7.85062656096858, -3.57568856310991, 1.82162445212887, 8.30388660919105, 8.08893629853881, -4.4411300389388, -9.32259121998441, 
        4.89682116173602, -4.10649901649145, -1.12346156535353, -3.45232289178815, 3.11296281899015, 1.14257598016022, -5.58127984272338, 
        10.6374053487073, 3.71597106664051, -6.64075828437418, -4.46357381263293, 10.9196678926585, -4.22525934324648, -3.05766369787142, 
        3.15915277560903, -2.26691781115588, 6.72033350347991), .Dim = c(30L, 1L))
    X <- structure(c(1.31468612214649, 1.50526450892547, -0.481943147829764, 0.53768175731034, 0.177827944425163, 0.267227455192865, 
        -0.334799092750676, -1.03999323576562, 1.53128722322662, 1.35003125538011, 1.28855227366402, -0.0234648252141323, 
        -1.63367402686803, 0.51878004140343, -0.181280915799627, -0.179105789093214, -0.279899000475669, -0.166562805125477, 
        0.098327997783465, 0.169627873842723, -1.93525931283258, -0.989742861701422, 0.338214063988588, -0.194912906976375, 
        -0.604084383704907, -1.10267063071402, 0.966429099041676, 0.578766302962042, 0.646713762693547, -0.64622016805239, 
        -0.37521980264247, 2.25152134790583, -1.78840474234458, 0.837565357199543, -0.275502819330842, -0.576937353424207, 
        0.22424916655646, -0.146835168669536, 0.410841318048265, -0.249902338209089, 1.08044286130849, 0.0443192169335143, 
        -1.60768261866817, -0.411220098317161, -0.932583327866977, -1.42960233764264, -1.06565116783418, 0.658797645492316, 
        -0.523175373811017, -0.31718621770838, 0.273639382111404, 1.90697750477262, -0.376248694209834, 0.783930053659556, 
        1.05647154150633, -0.174737498343692, 1.05790470627275, 0.124433396264805, -1.61011286104727, 0.324494870432421, 
        0.393250458305747, -1.15613098972987, -0.204148479959356, 1.04377652480886, 0.625697693701624, 1.55278666576289, 
        0.720694130064805, 0.491365896500678, 0.10746304117074, 0.736291734858734, -0.697014472577442, -0.546096650663984, 
        -0.145984791196719, 0.0900819014523767, -0.536347970895942, 0.962930334169472, 0.0281822676282678, -1.46744796985119, 
        0.331351211521205, 0.0786639018683993, 1.34361953478974, 0.290501610102339, -0.645765028554885, -1.14990091208213, 
        1.44319815961227, -1.1624823258504, 0.307450812441229, 0.20938585776011, -0.650839001717713, -0.55303510105462, 0.700054463945665, 
        -0.382473068804791, 1.33853693910244, -0.466018276927681, -0.779835630632884, 0.796773217701868, 1.39371123260298, 
        -0.929030669876813, -0.213433632676625, 1.31119620641323, 1.68263542999754, -0.717003423899936, -1.00889939554747, 
        1.23255890315244, -0.11275188306751, -0.243485525870861, -0.281417089632233, 1.59106856067114, 0.274136273858794, 
        -1.33813174668864, 1.99863182323697, 0.00506352212241864, -1.07229496856961, -0.596704569182319, 1.27030367862848, 
        0.178583315426528, -1.76556366169557, 0.425840526709262, 0.564777788349562, 2.09416730845783, 0.480412552976151, 
        -0.122753569031427, 1.93868169060902, 0.270945288237918, -1.38173237438062, 0.211155460976489, -0.433979279933755, 
        -0.553559716496045, -1.13391480983739, -1.0580479949854, -0.483979454840882, -1.74089854400673, -0.160762745674477, 
        1.4278167137675, -0.318765739822133, -0.602179883320676, 0.676519467812038, 0.96510723198331, -0.364551674606692, 
        -0.958816281710972, -1.26845388397876, 0.493605919272459, 0.298854826918304, -0.347458360497875, -1.00204561365713, 
        1.17087286010359, -0.112677655235366, -0.211902145705357, 0.162655022340026, 0.0383826690114277, 0.0993705891756193, 
        0.536186185120744, -0.271697543739142, -1.75223993402787, 0.223247054290215, 0.357472428353459, 1.2909026078482, 
        0.588923248289728, 0.463944826427072, -1.0741419699012, 0.0204692266277849, -0.566351777560928, -0.533721945299983, 
        -0.920988989090031, 1.00588177972384, -1.28755489660225, 1.37968243451659, -0.175299546265446, -1.27012009545175, 
        1.01396990724161, -1.33009303245353, 0.0939796693284924, -0.100316859670355, -0.289319063020977, 2.01601841897852, 
        -0.96993229603174, 1.09367750587649, 1.29629566039593, 0.58355329998676, -0.457717898435353, 1.51393376599081, -0.51865113304364, 
        -0.436472666776732, -1.061406374266, -0.64317363822192, 0.66836708918433, 0.573784299349126, 0.838063323745361, -0.174289913670767, 
        -1.36106828304496, -0.422217455567251, -0.322977177177106, -0.871916642499323, -0.0886006780756828, -0.407174815802462, 
        -0.22253328243823, -0.783437882958881, -1.36163799385693, 0.595997189373645, 0.576014548940055, -0.943052585485044, 
        0.0208325961777843, 0.466563946737377, 1.28946737998799, 1.19898934379374, -0.825983276255117, 0.846485953946663, 
        0.49119859850924, 2.35872454917687, -0.125519483528157, 0.256287573398563, -2.87171672129638, -1.73586141467345, 
        -1.18453351167051, 1.31839125151008, -0.132272839489939, 1.18209596293867, 0.437789836648362, -0.0911658475519318, 
        -1.55417369173163, -0.141939534791886, 2.47980997547782, -2.19114279047184, 1.11774852287976, -0.407585807843159, 
        -0.846385263324521, 0.395876553593261, 0.540801125343799, 0.490602221511861, 0.816520325421953, -1.20022602486323, 
        1.40954496788627, -0.229471494329338, 0.114997475768825, 0.158001695082951, -0.146608878598923, -0.360668686863609, 
        -1.00888447036238, -0.765976502751031, 0.815986381749546, 2.004880140283, -2.55083831283376, 0.212014385098595, -2.48665641966346, 
        -0.229532633165363, -2.91443294798371, 1.09489757338341, -0.928017678102426, 0.985647302471634, -0.0201275411815388, 
        0.179825226873911, -1.07517422721621, -1.40618001076559, -0.354454296806535, 0.536476056045553, -0.482375394055112, 
        0.207788240265395, 0.520096377016143, -0.925110197864377, 1.87632776179271, -0.776467620641964, -0.197920621684767, 
        -0.542772053060473, 0.164275768849031, 0.616527507644448, -1.05405058974153, -2.67085596917401, 1.37456304136125, 
        -2.10818606092475, 0.0160553442576345, 0.141798891565609, 1.02897614688914, -0.617840765979337, -0.22092901620951, 
        0.628864351084944, -0.012685466790623, 0.826216171859206, -1.17363055901948, 0.907775086642352, 0.632670862995653, 
        0.13449321447318, 0.03931811086305, 0.0239920789046528, -0.0817786299081287, -0.988520835387333, 1.2151096689042, 
        0.90447162631662, 0.0480436664953945, -1.66056617368385, 0.319873235443271, -0.267168989057184, -1.27682614627624, 
        1.17568945347867, -0.910285507946096, -0.893090847641424, -0.484573795861553, -0.209721081262613, 1.31950462282692, 
        0.0550119494983048, -1.59520157071926), .Dim = c(30L, 10L))
    expect_equal(gamreg:::cv.gam(X = X, Y = Y, init.mode = "sLTS", nlambda = 5, nlambda.LTS = 20), list(lambda = c(0.0334495023916401, 
        0.0707370852106133, 0.149590722322498, 0.316345862122253, 0.668990047832802), fit = list(list(beta0 = 0.000120691156713107, 
        beta = structure(c(0.999155308329664, 2.00032404155761, 2.99965376873276, 3.99995878633575, 0, -0.000442617912653438, 
            0.000425881611602428, 0, 0, 0.000465567935933336), .Dim = c(10L, 1L)), sigma = 0.000697796974316589), list(beta0 = 0.000134112472989735, 
        beta = structure(c(0.999317986012865, 1.99987884898047, 2.99950593945663, 3.9997382405865, 0, 0, 0, 0, 0, 0), .Dim = c(10L, 
            1L)), sigma = 0.000764641771356745), list(beta0 = 0.0771848861353977, beta = structure(c(0.56002182306438, 1.66402910249852, 
        2.48957824342336, 3.65912314819777, 0, 0, 0, 0, 0, 0), .Dim = c(10L, 1L)), sigma = 0.758938454552717), list(beta0 = 0.0771848861353977, 
        beta = structure(c(0.0797353356647204, 1.28668173799093, 1.92749656859454, 3.29715762981639, 0, 0, 0, 0, 0, 0), .Dim = c(10L, 
            1L)), sigma = 1.59829486805623), list(beta0 = 0.44449239718445, beta = structure(c(0, 0, 0, 0, 0, 0, 0, 0, 0, 
        0), .Dim = c(10L, 1L)), sigma = 5.54330834092946)), Rocv = list(beta0 = 0.000134112472989735, beta = structure(c(0.999317986012865, 
        1.99987884898047, 2.99950593945663, 3.9997382405865, 0, 0, 0, 0, 0, 0), .Dim = c(10L, 1L)), sigma = 0.000764641771356745)))
})

library(testthat)

.Random.seed <<- .ext.seed

test_that("predict.biglm", {
    biglm <- biglm::biglm
    chunk1 <- structure(list(Girth = c(8.3, 8.6, 8.8, 10.5, 10.7, 10.8, 11, 11, 11.1, 11.2), Height = c(70, 65, 63, 72, 81, 
        83, 66, 75, 80, 75), Volume = c(10.3, 10.3, 10.2, 16.4, 18.8, 19.7, 15.6, 18.2, 22.6, 19.9)), row.names = c(NA, 10L), 
        class = "data.frame")
    ff <- log(Volume) ~ log(Girth) + log(Height)
    trees <- structure(list(Girth = c(8.3, 8.6, 8.8, 10.5, 10.7, 10.8, 11, 11, 11.1, 11.2, 11.3, 11.4, 11.4, 11.7, 12, 12.9, 
        12.9, 13.3, 13.7, 13.8, 14, 14.2, 14.5, 16, 16.3, 17.3, 17.5, 17.9, 18, 18, 20.6), Height = c(70, 65, 63, 72, 81, 
        83, 66, 75, 80, 75, 79, 76, 76, 69, 75, 74, 85, 86, 71, 64, 78, 80, 74, 72, 77, 81, 82, 80, 80, 80, 87), Volume = c(10.3, 
        10.3, 10.2, 16.4, 18.8, 19.7, 15.6, 18.2, 22.6, 19.9, 24.2, 21, 21.4, 21.3, 19.1, 22.2, 33.8, 27.4, 25.7, 24.9, 34.5, 
        31.7, 36.3, 38.3, 42.6, 55.4, 55.7, 58.3, 51.5, 51, 77)), row.names = c(NA, -31L), class = "data.frame")
    a <- structure(list(call = biglm(ff, chunk1), qr = structure(list(D = c(31, 1.637533565667, 0.158482336758735), rbar = c(2.55733343471497, 
        4.32723209681184, 0.194535388674822), thetab = c(3.272731722267, 2.1999699320931, 1.11712333313337), ss = 0.185463372769671, 
        checked = FALSE, tol = c(0, 0, 0)), class = "bigqr"), assign = 0:2, terms = log(Volume) ~ log(Girth) + log(Height), 
        n = 31L, names = c("(Intercept)", "log(Girth)", "log(Height)"), weights = NULL, df.resid = 7L), class = "biglm")
    expect_equal(biglm:::predict.biglm(object = a, newdata = trees), structure(c(2.31026984629157, 2.29787943411103, 2.30854665478851, 
        2.80790032636384, 2.97688810245616, 3.02257975184755, 2.80293079170561, 2.94573643377241, 3.03577657720276, 2.98146082209075, 
        3.05712992963309, 3.03134943889404, 3.03134943889404, 2.97490564192595, 3.11824953255461, 3.246640916533, 3.40145875318938, 
        3.47506830493567, 3.3197016395981, 3.21816715510323, 3.46769073789004, 3.5240970172273, 3.4784549969458, 3.64301916510791, 
        3.75485251606772, 3.92947755053622, 3.96597408760745, 3.98319694864988, 3.99424238061737, 3.99424238061737, 4.35544611711887), 
        .Dim = c(31L, 1L), .Dimnames = list(c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", 
            "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31"), NULL)))
})

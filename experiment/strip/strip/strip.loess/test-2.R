library(testthat)

.Random.seed <<- .ext.seed

test_that("strip.loess", {
    cars <- structure(list(speed = c(4, 4, 7, 7, 8, 9, 10, 10, 10, 11, 11, 12, 12, 12, 12, 13, 13, 13, 13, 14, 14, 14, 14, 
        15, 15, 15, 16, 16, 17, 17, 17, 18, 18, 18, 18, 19, 19, 19, 20, 20, 20, 20, 20, 22, 23, 24, 24, 24, 24, 25), dist = c(2, 
        10, 4, 22, 16, 10, 18, 26, 34, 17, 28, 14, 20, 24, 28, 26, 34, 34, 46, 26, 36, 60, 80, 20, 26, 54, 32, 40, 32, 40, 
        50, 42, 56, 76, 84, 36, 46, 68, 32, 48, 52, 56, 64, 66, 54, 70, 92, 93, 120, 85)), row.names = c(NA, -50L), class = "data.frame")
    r1 <- structure(list(n = 50L, fitted = c(5.89362799029163, 5.89362799029163, 12.4997857340761, 12.4997857340761, 15.2810822239864, 
        18.446568364119, 21.8653153728752, 21.8653153728752, 21.8653153728752, 25.5170148442874, 25.5170148442874, 29.350385881853, 
        29.350385881853, 29.350385881853, 29.350385881853, 33.2306603491852, 33.2306603491852, 33.2306603491852, 33.2306603491852, 
        37.1679351832335, 37.1679351832335, 37.1679351832335, 37.1679351832335, 41.205226197756, 41.205226197756, 41.205226197756, 
        45.0557364502057, 45.0557364502057, 48.3558889750956, 48.3558889750956, 48.3558889750956, 49.8248119259973, 49.8248119259973, 
        49.8248119259973, 49.8248119259973, 51.9867021665732, 51.9867021665732, 51.9867021665732, 56.4613182692202, 56.4613182692202, 
        56.4613182692202, 56.4613182692202, 56.4613182692202, 68.569312909199, 76.316067861104, 85.2121213551067, 85.2121213551067, 
        85.2121213551067, 85.2121213551067, 95.3240474368896), residuals = structure(c(-3.89362799029163, 4.10637200970837, 
        -8.49978573407609, 9.50021426592391, 0.718917776013578, -8.44656836411902, -3.86531537287523, 4.13468462712477, 12.1346846271248, 
        -8.51701484428737, 2.48298515571263, -15.350385881853, -9.35038588185301, -5.35038588185301, -1.35038588185301, -7.23066034918519, 
        0.769339650814807, 0.769339650814807, 12.7693396508148, -11.1679351832335, -1.16793518323352, 22.8320648167665, 42.8320648167665, 
        -21.205226197756, -15.205226197756, 12.794773802244, -13.0557364502057, -5.05573645020569, -16.3558889750956, -8.35588897509563, 
        1.64411102490437, -7.8248119259973, 6.1751880740027, 26.1751880740027, 34.1751880740027, -15.9867021665732, -5.9867021665732, 
        16.0132978334268, -24.4613182692202, -8.46131826922018, -4.46131826922018, -0.461318269220179, 7.53868173077982, 
        -2.56931290919904, -22.316067861104, -15.2121213551067, 6.78787864489334, 7.78787864489334, 34.7878786448933, -10.3240474368896), 
        names = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", 
            "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38", 
            "39", "40", "41", "42", "43", "44", "45", "46", "47", "48", "49", "50")), enp = 4.77910430832514, s = 15.2949592875652, 
        one.delta = 44.3015430825705, two.delta = 43.9874278192897, trace.hat = 5.23878061287732, divisor = 1, robust = c(1, 
            1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
            1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1), pars = list(span = 0.75, degree = 2L, normalize = TRUE, parametric = FALSE, 
            drop.square = FALSE, surface = "interpolate", cell = 0.2, family = "gaussian", trace.hat = "exact", iterations = 1L), 
        kd = list(parameter = structure(c(1L, 50L, 2L, 19L, 11L, 1049L, 849L), names = c("d", "n", "vc", "nc", "nv", "liv", 
            "lv")), a = c(1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 0L, 1L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L), xi = c(15, 12, 19, 
            10, 14, 17, 22, 8, 0, 13, 0, 0, 0, 0, 0, 0, 0, 0, 0), vert = c(3.895, 25.105), vval = c(5.71156620445218, 1.71761824198573, 
            96.459045409631, 10.8770776101743, 41.205226197756, 3.7066260215702, 29.350385881853, 3.79016888738727, 51.9867021665732, 
            3.99184514579913, 21.8653153728752, 3.42682575508024, 37.1679351832335, 3.92572897995294, 48.3558889750956, 2.60591056645067, 
            68.569312909199, 7.194297029417, 15.2810822239864, 2.92030401783299, 33.2306603491852, 3.89831046745822)), call = stats::loess(formula = dist ~ 
            speed, data = cars), terms = dist ~ speed, xnames = structure("speed", names = "speed"), x = structure(c(4, 4, 
            7, 7, 8, 9, 10, 10, 10, 11, 11, 12, 12, 12, 12, 13, 13, 13, 13, 14, 14, 14, 14, 15, 15, 15, 16, 16, 17, 17, 17, 
            18, 18, 18, 18, 19, 19, 19, 20, 20, 20, 20, 20, 22, 23, 24, 24, 24, 24, 25), .Dim = c(50L, 1L), .Dimnames = list(c("1", 
            "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", 
            "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "40", 
            "41", "42", "43", "44", "45", "46", "47", "48", "49", "50"), "speed")), y = structure(c(2, 10, 4, 22, 16, 10, 
            18, 26, 34, 17, 28, 14, 20, 24, 28, 26, 34, 34, 46, 26, 36, 60, 80, 20, 26, 54, 32, 40, 32, 40, 50, 42, 56, 76, 
            84, 36, 46, 68, 32, 48, 52, 56, 64, 66, 54, 70, 92, 93, 120, 85), names = c("1", "2", "3", "4", "5", "6", "7", 
            "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", 
            "27", "28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "40", "41", "42", "43", "44", "45", 
            "46", "47", "48", "49", "50")), weights = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
            1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)), class = "loess")
    expect_equal(strip:::strip.loess(object = r1, keep = "print"), structure(list(call = stats::loess(formula = dist ~ speed, 
        data = cars), n = 50L, enp = 4.77910430832514, pars = list(family = "gaussian"), s = 15.2949592875652), class = "loess"))
})

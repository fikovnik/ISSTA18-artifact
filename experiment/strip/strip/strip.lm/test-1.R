library(testthat)

.Random.seed <<- .ext.seed

test_that("strip.lm", {
    i <- c(1L, 1L, 2L, 1L, 1L, 1L, 2L, 2L, 1L, 1L, 1L, 1L, 1L, 1L, 2L, 1L, 1L, 1L, 1L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 1L, 1L, 
        2L, 2L, 1L, 1L)
    lm <- stats::lm
    mtcars <- structure(list(mpg = c(21, 21, 22.8, 21.4, 18.7, 18.1, 14.3, 24.4, 22.8, 19.2, 17.8, 16.4, 17.3, 15.2, 10.4, 
        10.4, 14.7, 32.4, 30.4, 33.9, 21.5, 15.5, 15.2, 13.3, 19.2, 27.3, 26, 30.4, 15.8, 19.7, 15, 21.4), cyl = c(6, 6, 
        4, 6, 8, 6, 8, 4, 4, 6, 6, 8, 8, 8, 8, 8, 8, 4, 4, 4, 4, 8, 8, 8, 8, 4, 4, 4, 8, 6, 8, 4), disp = c(160, 160, 108, 
        258, 360, 225, 360, 146.7, 140.8, 167.6, 167.6, 275.8, 275.8, 275.8, 472, 460, 440, 78.7, 75.7, 71.1, 120.1, 318, 
        304, 350, 400, 79, 120.3, 95.1, 351, 145, 301, 121), hp = c(110, 110, 93, 110, 175, 105, 245, 62, 95, 123, 123, 180, 
        180, 180, 205, 215, 230, 66, 52, 65, 97, 150, 150, 245, 175, 66, 91, 113, 264, 175, 335, 109), drat = c(3.9, 3.9, 
        3.85, 3.08, 3.15, 2.76, 3.21, 3.69, 3.92, 3.92, 3.92, 3.07, 3.07, 3.07, 2.93, 3, 3.23, 4.08, 4.93, 4.22, 3.7, 2.76, 
        3.15, 3.73, 3.08, 4.08, 4.43, 3.77, 4.22, 3.62, 3.54, 4.11), wt = c(2.62, 2.875, 2.32, 3.215, 3.44, 3.46, 3.57, 3.19, 
        3.15, 3.44, 3.44, 4.07, 3.73, 3.78, 5.25, 5.424, 5.345, 2.2, 1.615, 1.835, 2.465, 3.52, 3.435, 3.84, 3.845, 1.935, 
        2.14, 1.513, 3.17, 2.77, 3.57, 2.78), qsec = c(16.46, 17.02, 18.61, 19.44, 17.02, 20.22, 15.84, 20, 22.9, 18.3, 18.9, 
        17.4, 17.6, 18, 17.98, 17.82, 17.42, 19.47, 18.52, 19.9, 20.01, 16.87, 17.3, 15.41, 17.05, 18.9, 16.7, 16.9, 14.5, 
        15.5, 14.6, 18.6), vs = c(0, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 
        0, 0, 1), am = c(1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1), 
        gear = c(4, 4, 4, 3, 3, 3, 3, 4, 4, 4, 4, 3, 3, 3, 3, 3, 3, 4, 4, 4, 3, 3, 3, 3, 3, 4, 5, 5, 5, 5, 5, 4), carb = c(4, 
            4, 1, 1, 2, 1, 4, 2, 2, 4, 4, 3, 3, 3, 4, 4, 4, 1, 2, 1, 1, 2, 2, 4, 2, 1, 2, 2, 4, 6, 8, 2)), row.names = c("Mazda RX4", 
        "Mazda RX4 Wag", "Datsun 710", "Hornet 4 Drive", "Hornet Sportabout", "Valiant", "Duster 360", "Merc 240D", "Merc 230", 
        "Merc 280", "Merc 280C", "Merc 450SE", "Merc 450SL", "Merc 450SLC", "Cadillac Fleetwood", "Lincoln Continental", 
        "Chrysler Imperial", "Fiat 128", "Honda Civic", "Toyota Corolla", "Toyota Corona", "Dodge Challenger", "AMC Javelin", 
        "Camaro Z28", "Pontiac Firebird", "Fiat X1-9", "Porsche 914-2", "Lotus Europa", "Ford Pantera L", "Ferrari Dino", 
        "Maserati Bora", "Volvo 142E"), class = "data.frame")
    r1 <- structure(list(coefficients = structure(c(-76.5280963045235, 5.20424225070009, 0.00624910642322927, -0.0058000884167934, 
        5.9103399796142, -1.18619560451469, 1.58170988437832, 3.81201447339277, 7.47888729387102, 6.4318109094232, -3.56068459849639), 
        names = c("(Intercept)", "cyl", "disp", "hp", "drat", "wt", "qsec", "vs", "am", "gear", "carb")), residuals = structure(c(0.999964827341182, 
        0.416687171240661, 1.0429520447996, -1.27232836015089, -1.13163487855024, 0.111199684705163, 0.838872997274962, -1.51015293335203, 
        1.162612114415, 1.34296363200434, -1.33041054152125, -0.869271100012681, 2.8223086603872, 2.24421941952368, -0.472638921699108, 
        1.84536829684691, -1.71768337772763, 0.510572057728451, -2.27042251350404, -1.08830738420477, 2.62549533507629, -0.977107699499614, 
        -3.32325853112119), names = c("Mazda RX4", "Mazda RX4 Wag", "Hornet 4 Drive", "Hornet Sportabout", "Valiant", "Merc 230", 
        "Merc 280", "Merc 280C", "Merc 450SE", "Merc 450SL", "Merc 450SLC", "Lincoln Continental", "Chrysler Imperial", "Fiat 128", 
        "Honda Civic", "Toyota Corolla", "Dodge Challenger", "Camaro Z28", "Fiat X1-9", "Porsche 914-2", "Lotus Europa", 
        "Maserati Bora", "Volvo 142E")), effects = structure(c(-100.003512981773, -26.4586398379353, 5.13417817154952, -1.71901949117746, 
        0.923840142100641, 8.24533876254147, 2.60627906973286, 0.298317553257741, -3.84866802661649, 0.38335300419972, -5.92719922015465, 
        -2.034421030994, 1.63289669429406, 2.29842298211561, -0.404255323966879, 2.36645524173334, -1.17350083289166, -0.467740414759699, 
        -2.30627783424013, -1.13682720465923, 3.32623948839737, -0.779614664440761, -4.60227504861564), names = c("(Intercept)", 
        "cyl", "disp", "hp", "drat", "wt", "qsec", "vs", "am", "gear", "carb", "", "", "", "", "", "", "", "", "", "", "", 
        "")), rank = 11L, fitted.values = structure(c(20.0000351726588, 20.5833128287593, 20.3570479552004, 19.9723283601509, 
        19.2316348785502, 22.6888003152948, 18.361127002725, 19.310152933352, 15.237387885585, 15.9570363679957, 16.5304105415212, 
        11.2692711000127, 11.8776913396128, 30.1557805804763, 30.8726389216991, 32.0546317031531, 17.2176833777276, 12.7894279422715, 
        29.570422513504, 27.0883073842048, 27.7745046649237, 15.9771076994996, 24.7232585311212), names = c("Mazda RX4", 
        "Mazda RX4 Wag", "Hornet 4 Drive", "Hornet Sportabout", "Valiant", "Merc 230", "Merc 280", "Merc 280C", "Merc 450SE", 
        "Merc 450SL", "Merc 450SLC", "Lincoln Continental", "Chrysler Imperial", "Fiat 128", "Honda Civic", "Toyota Corolla", 
        "Dodge Challenger", "Camaro Z28", "Fiat X1-9", "Porsche 914-2", "Lotus Europa", "Maserati Bora", "Volvo 142E")), 
        assign = 0:10, qr = structure(list(qr = structure(c(-4.79583152331272, 0.208514414057075, 0.208514414057075, 0.208514414057075, 
            0.208514414057075, 0.208514414057075, 0.208514414057075, 0.208514414057075, 0.208514414057075, 0.208514414057075, 
            0.208514414057075, 0.208514414057075, 0.208514414057075, 0.208514414057075, 0.208514414057075, 0.208514414057075, 
            0.208514414057075, 0.208514414057075, 0.208514414057075, 0.208514414057075, 0.208514414057075, 0.208514414057075, 
            0.208514414057075, -29.1920179679905, 8.23565947307936, 0.0087367909419909, -0.23410957813599, 0.0087367909419909, 
            0.251583160019972, 0.0087367909419909, 0.0087367909419909, -0.23410957813599, -0.23410957813599, -0.23410957813599, 
            -0.23410957813599, -0.23410957813599, 0.251583160019972, 0.251583160019972, 0.251583160019972, -0.23410957813599, 
            -0.23410957813599, 0.251583160019972, 0.251583160019972, 0.251583160019972, -0.23410957813599, 0.251583160019972, 
            -1037.63027867222, 499.860184157216, -237.604232026543, 0.111662614128366, 0.097206956489192, 0.296552204527174, 
            -0.144371232209012, -0.144371232209012, -0.242708178352275, -0.242708178352275, -0.242708178352275, 0.532530538689697, 
            0.448356953777431, 0.0351932233745876, 0.0225671856377477, 0.00320726110792636, -0.0651019141873932, 0.0695758216722328, 
            0.0364558271482716, 0.210274279992101, 0.104215563002646, -0.13664946136282, 0.213220355464031, -673.084528576237, 
            265.346613099945, -45.9891057522304, 176.955911062057, 0.166344432803134, -0.150984310501303, 0.0387879266333693, 
            0.0387879266333693, 0.10131640240766, 0.10131640240766, 0.10131640240766, -0.0135629103789413, -0.107331966565694, 
            -0.0150534465124399, 0.0627119787981096, -0.0128231493373524, 0.289844754459022, -0.232608648866108, -0.0149184138290956, 
            -0.137607043250593, -0.273274542020641, -0.763265250928479, -0.239012219746017, -17.4401455917337, -2.07792023628464, 
            0.415525168131305, 0.633810723268209, 1.54938440436482, 0.100332481893636, -0.0741485941375311, -0.0741485941375311, 
            0.15233964872378, 0.15233964872378, 0.15233964872378, -0.188156228184917, -0.263055033469932, 0.0981133616715127, 
            -0.466834896133238, 0.024415775050162, 0.200014070952117, -0.343244716070551, 0.0973891964672153, -0.186084435163521, 
            0.337783106231365, 0.049282355942183, 0.0490829668877527, -15.2084158180809, 3.97778129134619, -1.88591787221303, 
            -0.114875287062223, -0.0835869498087788, -1.98956527213249, 0.344253724180349, 0.344253724180349, 0.222770782005759, 
            0.0518791783160869, 0.0770102965057445, 0.269928027731205, 0.284378533031657, 0.035277602079044, -0.142876314744382, 
            -0.109944564723196, -0.15452198623164, -0.17942361972048, -0.0988301828552553, -0.13577521046679, -0.478208102314493, 
            -0.354428142530728, 0.119474513923292, -86.4021177528301, -4.31442971011498, -1.48322740166067, -3.3048440311207, 
            -2.27696234395421, -3.37937599775832, 4.28981897723929, 0.0802254815326205, 0.191937509552589, -0.077692979408407, 
            -0.138141643236189, 0.331387746526042, 0.288370130490805, -0.0743125905302327, -0.396410246411948, -0.427570023225796, 
            0.0758273101952068, -0.201115353423902, -0.116064857117697, 0.198394669453116, -0.116148419847394, -0.449499317423221, 
            0.17361099957832, -2.29365855462782, -1.81606849919186, -0.0311895506555682, -0.205547477129314, -0.543536113172949, 
            -0.400160017518851, 0.634590325225134, -1.24078147181046, -0.105969415140776, -0.064859912507115, -0.073580571122495, 
            -0.228094027948498, -0.150663541689633, 0.119671175396363, 0.487073914737488, 0.20654929268342, -0.112808023031086, 
            0.174598934662683, 0.156366770163903, -0.531244711139621, 0.112640500950184, 0.105892200074621, 0.0712190606129035, 
            -2.08514414057075, -1.56266359232788, 0.507547292347525, 0.856206927261819, 0.383455842330825, 0.666077015082066, 
            -0.728793969130711, 0.39591692482406, -0.970038153968321, -0.0637862792913906, -0.0132948458572926, 0.397922156534725, 
            0.290142288947534, 0.159998099571611, 0.00370200660679009, 0.0958126538653968, -0.0853698676676848, -0.402569082053609, 
            0.0284972248187558, -0.550057844216651, -0.470205401548993, 0.104850857035023, 0.114367754909713, -17.7237251948514, 
            -2.11170755719983, 0.639363126320135, 1.92801114781635, 0.258184280116414, 0.278464740686171, -0.734109098315486, 
            0.284755013047138, 0.168991937532843, 1.22126271617274, 0.0899702253267427, -0.259712844191902, -0.0199663055363689, 
            0.10236658747466, 0.0839844910896198, -0.00983341530831635, -0.111981150642044, 0.613618356249856, 0.165676458075896, 
            -0.0642417343417037, -0.119353796995921, -0.518281841753198, 0.422439443471448, -13.3449224996528, 4.18118096325567, 
            1.06269798440851, 4.8777655851342, 2.01861547713242, -1.68040322909753, -1.00379049330843, -0.0661912106148447, 
            -0.651339298970302, 2.09835430526676, 1.66462348916206, -0.0201417541524403, 0.185369939363067, 0.435116215177537, 
            -0.00720596425798145, 0.390567010462108, 0.0468953767756739, -0.111316616356187, 0.248341936525746, 0.616670320406215, 
            0.294471037086675, 0.193238801485665, 0.157592394635927), .Dim = c(23L, 11L), .Dimnames = list(c("Mazda RX4", 
            "Mazda RX4 Wag", "Hornet 4 Drive", "Hornet Sportabout", "Valiant", "Merc 230", "Merc 280", "Merc 280C", "Merc 450SE", 
            "Merc 450SL", "Merc 450SLC", "Lincoln Continental", "Chrysler Imperial", "Fiat 128", "Honda Civic", "Toyota Corolla", 
            "Dodge Challenger", "Camaro Z28", "Fiat X1-9", "Porsche 914-2", "Lotus Europa", "Maserati Bora", "Volvo 142E"), 
            c("(Intercept)", "cyl", "disp", "hp", "drat", "wt", "qsec", "vs", "am", "gear", "carb")), assign = 0:10), qraux = c(1.20851441405707, 
            1.00873679094199, 1.23609337159443, 1.16747120129866, 1.5056554252127, 1.25377744843241, 1.22009152324288, 1.48098154223889, 
            1.02333230856595, 1.15642090832631, 1.13369855328606), pivot = 1:11, tol = 1e-07, rank = 11L), class = "qr"), 
        df.residual = 12L, xlevels = structure(list(), names = character()), call = lm(formula = mpg ~ ., data = mtcars[i == 
            1, ]), terms = mpg ~ cyl + disp + hp + drat + wt + qsec + vs + am + gear + carb, model = structure(list(mpg = c(21, 
            21, 21.4, 18.7, 18.1, 22.8, 19.2, 17.8, 16.4, 17.3, 15.2, 10.4, 14.7, 32.4, 30.4, 33.9, 15.5, 13.3, 27.3, 26, 
            30.4, 15, 21.4), cyl = c(6, 6, 6, 8, 6, 4, 6, 6, 8, 8, 8, 8, 8, 4, 4, 4, 8, 8, 4, 4, 4, 8, 4), disp = c(160, 
            160, 258, 360, 225, 140.8, 167.6, 167.6, 275.8, 275.8, 275.8, 460, 440, 78.7, 75.7, 71.1, 318, 350, 79, 120.3, 
            95.1, 301, 121), hp = c(110, 110, 110, 175, 105, 95, 123, 123, 180, 180, 180, 215, 230, 66, 52, 65, 150, 245, 
            66, 91, 113, 335, 109), drat = c(3.9, 3.9, 3.08, 3.15, 2.76, 3.92, 3.92, 3.92, 3.07, 3.07, 3.07, 3, 3.23, 4.08, 
            4.93, 4.22, 2.76, 3.73, 4.08, 4.43, 3.77, 3.54, 4.11), wt = c(2.62, 2.875, 3.215, 3.44, 3.46, 3.15, 3.44, 3.44, 
            4.07, 3.73, 3.78, 5.424, 5.345, 2.2, 1.615, 1.835, 3.52, 3.84, 1.935, 2.14, 1.513, 3.57, 2.78), qsec = c(16.46, 
            17.02, 19.44, 17.02, 20.22, 22.9, 18.3, 18.9, 17.4, 17.6, 18, 17.82, 17.42, 19.47, 18.52, 19.9, 16.87, 15.41, 
            18.9, 16.7, 16.9, 14.6, 18.6), vs = c(0, 0, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 1), am = c(1, 
            1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1), gear = c(4, 4, 3, 3, 3, 4, 4, 4, 3, 3, 3, 
            3, 3, 4, 4, 4, 3, 3, 4, 5, 5, 5, 4), carb = c(4, 4, 1, 2, 1, 2, 4, 4, 3, 3, 3, 4, 4, 1, 2, 1, 2, 4, 1, 2, 2, 
            8, 2)), terms = mpg ~ cyl + disp + hp + drat + wt + qsec + vs + am + gear + carb, row.names = c("Mazda RX4", 
            "Mazda RX4 Wag", "Hornet 4 Drive", "Hornet Sportabout", "Valiant", "Merc 230", "Merc 280", "Merc 280C", "Merc 450SE", 
            "Merc 450SL", "Merc 450SLC", "Lincoln Continental", "Chrysler Imperial", "Fiat 128", "Honda Civic", "Toyota Corolla", 
            "Dodge Challenger", "Camaro Z28", "Fiat X1-9", "Porsche 914-2", "Lotus Europa", "Maserati Bora", "Volvo 142E"), 
            class = "data.frame")), class = "lm")
    expect_equal(strip:::strip.lm(object = r1, keep = "predict"), structure(list(coefficients = structure(c(-76.5280963045235, 
        5.20424225070009, 0.00624910642322927, -0.0058000884167934, 5.9103399796142, -1.18619560451469, 1.58170988437832, 
        3.81201447339277, 7.47888729387102, 6.4318109094232, -3.56068459849639), names = c("(Intercept)", "cyl", "disp", 
        "hp", "drat", "wt", "qsec", "vs", "am", "gear", "carb")), rank = 11L, assign = 0:10, qr = structure(list(qraux = c(1.20851441405707, 
        1.00873679094199, 1.23609337159443, 1.16747120129866, 1.5056554252127, 1.25377744843241, 1.22009152324288, 1.48098154223889, 
        1.02333230856595, 1.15642090832631, 1.13369855328606), pivot = 1:11, tol = 1e-07, rank = 11L), class = "qr"), df.residual = 12L, 
        xlevels = structure(list(), names = character()), call = lm(formula = mpg ~ ., data = mtcars[i == 1, ]), terms = mpg ~ 
            cyl + disp + hp + drat + wt + qsec + vs + am + gear + carb), class = "lm"))
})

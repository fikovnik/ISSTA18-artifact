library(testthat)

.Random.seed <<- .ext.seed

test_that("OptFact", {
    PN <- structure(c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 10, 11, 9, 10, 11, 12, 2, 4, 
        18, 17, 14, 14, 11, 7, 0, 0, 9, 8, 0, 0), .Dim = c(20L, 2L), .Dimnames = list(c("PN", "", "", "", "", "", "", "", 
        "", "", "", "", "", "", "", "", "", "", "", ""), NULL))
    n <- c(5L, 6L, 3L, 4L, 5L, 6L, 1L, 1L, 9L, 8L, 4L, 7L, 6L, 3L, 0L, 0L, 3L, 2L, 0L, 0L)
    Cap <- 1:20
    expect_equal(Sofi:::OptFact(V1 = Cap, Ns = PN[, 2], n = n), structure(list(NT = 1:167, Capit = c(1L, 1L, 1L, 1L, 1L, 
        1L, 1L, 1L, 1L, 1L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 4L, 4L, 4L, 4L, 
        4L, 4L, 4L, 4L, 4L, 4L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 
        7L, 7L, 8L, 8L, 8L, 8L, 9L, 9L, 9L, 9L, 9L, 9L, 9L, 9L, 9L, 9L, 9L, 9L, 9L, 9L, 9L, 9L, 9L, 9L, 10L, 10L, 10L, 10L, 
        10L, 10L, 10L, 10L, 10L, 10L, 10L, 10L, 10L, 10L, 10L, 10L, 10L, 11L, 11L, 11L, 11L, 11L, 11L, 11L, 11L, 11L, 11L, 
        11L, 11L, 11L, 11L, 12L, 12L, 12L, 12L, 12L, 12L, 12L, 12L, 12L, 12L, 12L, 12L, 12L, 12L, 13L, 13L, 13L, 13L, 13L, 
        13L, 13L, 13L, 13L, 13L, 13L, 14L, 14L, 14L, 14L, 14L, 14L, 14L, 17L, 17L, 17L, 17L, 17L, 17L, 17L, 17L, 17L, 18L, 
        18L, 18L, 18L, 18L, 18L, 18L, 18L), FactorExp = c(2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1.83333333333333, 1.83333333333333, 
        1.83333333333333, 1.83333333333333, 1.83333333333333, 1.83333333333333, 1.83333333333333, 1.83333333333333, 1.83333333333333, 
        1.83333333333333, 1.83333333333333, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 
        2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 4, 4, 4, 4, 2, 2, 
        2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2.125, 2.125, 2.125, 2.125, 2.125, 2.125, 2.125, 2.125, 2.125, 2.125, 
        2.125, 2.125, 2.125, 2.125, 2.125, 2.125, 2.125, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5, 
        3.5, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1.83333333333333, 1.83333333333333, 1.83333333333333, 1.83333333333333, 
        1.83333333333333, 1.83333333333333, 1.83333333333333, 1.83333333333333, 1.83333333333333, 1.83333333333333, 1.83333333333333, 
        2.33333333333333, 2.33333333333333, 2.33333333333333, 2.33333333333333, 2.33333333333333, 2.33333333333333, 2.33333333333333, 
        3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4), EnMuestra = c(0L, 0L, 1L, 1L, 0L, 1L, 0L, 0L, 1L, 1L, 0L, 1L, 
        1L, 0L, 1L, 1L, 0L, 1L, 0L, 0L, 1L, 0L, 1L, 0L, 0L, 0L, 0L, 1L, 1L, 0L, 1L, 0L, 0L, 0L, 1L, 0L, 0L, 1L, 1L, 0L, 0L, 
        1L, 0L, 0L, 0L, 1L, 1L, 0L, 1L, 0L, 1L, 1L, 0L, 0L, 1L, 0L, 1L, 0L, 1L, 1L, 0L, 0L, 1L, 0L, 1L, 0L, 0L, 1L, 0L, 1L, 
        0L, 1L, 0L, 0L, 0L, 1L, 0L, 0L, 1L, 1L, 1L, 0L, 0L, 1L, 0L, 1L, 1L, 1L, 0L, 0L, 0L, 0L, 1L, 1L, 0L, 0L, 1L, 0L, 1L, 
        0L, 1L, 0L, 1L, 1L, 0L, 0L, 0L, 1L, 1L, 0L, 0L, 0L, 1L, 0L, 0L, 0L, 0L, 1L, 1L, 1L, 1L, 0L, 0L, 1L, 1L, 0L, 1L, 0L, 
        1L, 0L, 0L, 0L, 0L, 0L, 0L, 1L, 0L, 1L, 1L, 0L, 1L, 1L, 1L, 0L, 1L, 0L, 0L, 1L, 0L, 1L, 1L, 1L, 0L, 0L, 0L, 0L, 1L, 
        0L, 0L, 0L, 1L, 0L, 0L, 0L, 0L, 0L, 1L)), row.names = c(NA, -167L), class = "data.frame"))
})

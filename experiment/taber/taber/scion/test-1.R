library(testthat)

.Random.seed <<- .ext.seed

test_that("scion", {
    set_to_zero <- genthat::with_env(function(value) freduce(value, `_function_list`), env = list2env(list(freduce = magrittr::freduce, 
        `_function_list` = list(genthat::with_env(function(.) mutate(., zed = 0), env = list2env(list(mutate = dplyr::mutate), 
            parent = baseenv())))), parent = baseenv()))
    . <- structure(list(zed = c(0.914806043496355, 0.937075413297862, 0.286139534786344, 0.830447626067325, 0.641745518893003, 
        0.519095949130133, 0.736588314641267, 0.13466659723781, 0.656992290401831, 0.705064784036949, 0.45774177624844, 0.719112251652405, 
        0.934672247152776, 0.255428824340925, 0.462292822543532, 0.940014522755519, 0.978226428385824, 0.117487361654639, 
        0.474997081561014, 0.560332746244967, 0.904031387297437, 0.138710167724639, 0.988891728920862, 0.946668232558295, 
        0.0824375580996275, 0.514211784349754, 0.390203467104584, 0.905738130910322, 0.446969628101215, 0.836004259996116, 
        0.737595617771149, 0.811055141268298, 0.388108282815665, 0.685169729404151, 0.00394833879545331, 0.832916080253199, 
        0.00733414688147604, 0.207658972823992, 0.906601407798007, 0.611778643447906, 0.379559240536764, 0.435771584976465, 
        0.0374310328625143, 0.973539913771674, 0.431751248892397, 0.957576596643776, 0.887754905503243, 0.639978769468144, 
        0.970966610359028, 0.618838207330555, 0.333427211269736, 0.346748248208314, 0.39848541142419, 0.784692775690928, 
        0.038936491124332, 0.748795386170968, 0.67727683018893, 0.171264330390841, 0.261087963823229, 0.514412934659049, 
        0.67560727451928, 0.982817197917029, 0.759544267551973, 0.566488424083218, 0.849689718568698, 0.18947393540293, 0.271286614704877, 
        0.828158485237509, 0.693204820388928, 0.240544739644974, 0.0429887960199267, 0.140479094116017, 0.21638541505672, 
        0.479398564202711, 0.197410342283547, 0.719355837674811, 0.00788473873399198, 0.375489964615554, 0.514407708309591, 
        0.00157055421732366, 0.581604002509266, 0.157905208179727, 0.359028305858374, 0.645631878403947, 0.775823362637311, 
        0.563646841561422, 0.233703398611397, 0.0899805163498968, 0.0856120649259537, 0.305218369467184, 0.667426514672115, 
        0.000238896580412984, 0.208569956943393, 0.933034127345309, 0.925644748611376, 0.734094301005825, 0.333071983419359, 
        0.515063329832628, 0.743974646320567, 0.619159240042791)), row.names = c(NA, -100L), class = "data.frame")
    expect_equal(taber:::scion(.data = ., zed > 0.5, false_fun = set_to_zero), structure(list(zed = c(0.914806043496355, 
        0.937075413297862, 0.830447626067325, 0.641745518893003, 0.519095949130133, 0.736588314641267, 0.656992290401831, 
        0.705064784036949, 0.719112251652405, 0.934672247152776, 0.940014522755519, 0.978226428385824, 0.560332746244967, 
        0.904031387297437, 0.988891728920862, 0.946668232558295, 0.514211784349754, 0.905738130910322, 0.836004259996116, 
        0.737595617771149, 0.811055141268298, 0.685169729404151, 0.832916080253199, 0.906601407798007, 0.611778643447906, 
        0.973539913771674, 0.957576596643776, 0.887754905503243, 0.639978769468144, 0.970966610359028, 0.618838207330555, 
        0.784692775690928, 0.748795386170968, 0.67727683018893, 0.514412934659049, 0.67560727451928, 0.982817197917029, 0.759544267551973, 
        0.566488424083218, 0.849689718568698, 0.828158485237509, 0.693204820388928, 0.719355837674811, 0.514407708309591, 
        0.581604002509266, 0.645631878403947, 0.775823362637311, 0.563646841561422, 0.667426514672115, 0.933034127345309, 
        0.925644748611376, 0.734094301005825, 0.515063329832628, 0.743974646320567, 0.619159240042791)), class = "data.frame", 
        row.names = c(NA, -55L)))
})

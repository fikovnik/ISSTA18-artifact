library(testthat)

.Random.seed <<- .ext.seed

test_that("hdr", {
    prob <- 95
    currdate <- list(ages = 3445, ageSds = 50, calCurves = "intcal13", ageGrid = c(3470, 3471, 3472, 3473, 3474, 3475, 3476, 
        3477, 3478, 3479, 3480, 3481, 3482, 3483, 3484, 3485, 3486, 3487, 3488, 3489, 3490, 3491, 3492, 3493, 3494, 3495, 
        3496, 3497, 3498, 3499, 3500, 3501, 3502, 3503, 3504, 3505, 3506, 3507, 3508, 3509, 3510, 3511, 3512, 3513, 3514, 
        3515, 3516, 3517, 3518, 3519, 3520, 3521, 3522, 3523, 3524, 3525, 3526, 3527, 3528, 3529, 3530, 3531, 3532, 3533, 
        3534, 3535, 3536, 3537, 3538, 3539, 3540, 3541, 3542, 3543, 3544, 3545, 3546, 3547, 3548, 3549, 3550, 3551, 3552, 
        3553, 3554, 3555, 3556, 3557, 3558, 3559, 3560, 3561, 3562, 3563, 3564, 3565, 3566, 3567, 3568, 3569, 3570, 3571, 
        3572, 3573, 3574, 3575, 3576, 3577, 3578, 3579, 3580, 3581, 3582, 3583, 3584, 3585, 3586, 3587, 3588, 3589, 3590, 
        3591, 3592, 3593, 3594, 3595, 3596, 3597, 3598, 3599, 3600, 3601, 3602, 3603, 3604, 3605, 3606, 3607, 3608, 3609, 
        3610, 3611, 3612, 3613, 3614, 3615, 3616, 3617, 3618, 3619, 3620, 3621, 3622, 3623, 3624, 3625, 3626, 3627, 3628, 
        3629, 3630, 3631, 3632, 3633, 3634, 3635, 3636, 3637, 3638, 3639, 3640, 3641, 3642, 3643, 3644, 3645, 3646, 3647, 
        3648, 3649, 3650, 3651, 3652, 3653, 3654, 3655, 3656, 3657, 3658, 3659, 3660, 3661, 3662, 3663, 3664, 3665, 3666, 
        3667, 3668, 3669, 3670, 3671, 3672, 3673, 3674, 3675, 3676, 3677, 3678, 3679, 3680, 3681, 3682, 3683, 3684, 3685, 
        3686, 3687, 3688, 3689, 3690, 3691, 3692, 3693, 3694, 3695, 3696, 3697, 3698, 3699, 3700, 3701, 3702, 3703, 3704, 
        3705, 3706, 3707, 3708, 3709, 3710, 3711, 3712, 3713, 3714, 3715, 3716, 3717, 3718, 3719, 3720, 3721, 3722, 3723, 
        3724, 3725, 3726, 3727, 3728, 3729, 3730, 3731, 3732, 3733, 3734, 3735, 3736, 3737, 3738, 3739, 3740, 3741, 3742, 
        3743, 3744, 3745, 3746, 3747, 3748, 3749, 3750, 3751, 3752, 3753, 3754, 3755, 3756, 3757, 3758, 3759, 3760, 3761, 
        3762, 3763, 3764, 3765, 3766, 3767, 3768, 3769, 3770, 3771, 3772, 3773, 3774, 3775, 3776, 3777, 3778, 3779, 3780, 
        3781, 3782, 3783, 3784, 3785, 3786, 3787, 3788, 3789, 3790, 3791, 3792, 3793, 3794, 3795, 3796, 3797, 3798, 3799, 
        3800, 3801, 3802, 3803, 3804, 3805, 3806, 3807, 3808, 3809, 3810, 3811, 3812, 3813, 3814, 3815, 3816, 3817, 3818, 
        3819, 3820, 3821, 3822, 3823, 3824, 3825, 3826, 3827, 3828, 3829, 3830, 3831, 3832, 3833, 3834, 3835, 3836, 3837, 
        3838, 3839, 3840, 3841, 3842, 3843, 3844, 3845, 3846, 3847, 3848, 3849, 3850, 3851, 3852, 3853, 3854, 3855, 3856, 
        3857, 3858, 3859, 3860, 3861, 3862, 3863, 3864, 3865, 3866, 3867, 3868, 3869, 3870, 3871, 3872, 3873, 3874, 3875, 
        3876, 3877, 3878, 3879, 3880, 3881, 3882, 3883, 3884, 3885, 3886, 3887, 3888, 3889, 3890, 3891, 3892, 3893, 3894, 
        3895, 3896, 3897, 3898, 3899, 3900, 3901, 3902, 3903, 3904, 3905, 3906, 3907, 3908, 3909, 3910, 3911, 3912, 3913, 
        3914, 3915, 3916, 3917, 3918, 3919, 3920, 3921, 3922, 3923, 3924, 3925, 3926, 3927, 3948, 3949, 3950, 3951, 3952, 
        3953, 3954, 3955, 3956, 3957, 3958, 3959, 3960, 3961, 3962), densities = c(1.01108511388599e-05, 1.01108511388599e-05, 
        1.01108511388599e-05, 1.01108511388599e-05, 1.01108511388599e-05, 1.01108511388599e-05, 1.2607830263063e-05, 1.56712270163039e-05, 
        1.94158432261575e-05, 2.39762254925182e-05, 2.95092034173063e-05, 3.48852379411513e-05, 4.11480868811694e-05, 4.84250842452279e-05, 
        5.68581831864308e-05, 6.6604959275312e-05, 6.22375404161557e-05, 5.81310452785247e-05, 5.42718371954616e-05, 5.06468478486801e-05, 
        4.7243564068148e-05, 5.06468478486801e-05, 5.42718371954616e-05, 5.81310452785247e-05, 6.22375404161557e-05, 6.6604959275312e-05, 
        6.81211890098836e-05, 6.96685262482128e-05, 7.1247519481911e-05, 7.28587246166876e-05, 7.45027050171632e-05, 7.04779477822854e-05, 
        6.66507294932147e-05, 6.3012615986136e-05, 5.95554560420033e-05, 5.62713765426934e-05, 6.02792820731978e-05, 6.45438107632926e-05, 
        6.90790485970889e-05, 7.38996734985871e-05, 7.90209666545731e-05, 8.53369236581752e-05, 9.21027612460779e-05, 9.9345457703889e-05, 
        0.000107093165177008, 0.000115375222772138, 0.000115375222772138, 0.000115375222772138, 0.000115375222772138, 0.000115375222772138, 
        0.000115375222772138, 0.000112942804338761, 0.000110556085110568, 0.00010821434519174, 0.000105916872718454, 0.000103662963847805, 
        9.92830615655663e-05, 9.5069167462584e-05, 9.10159379241676e-05, 8.71181558863043e-05, 8.33707299996566e-05, 7.3775688586758e-05, 
        6.51867477552122e-05, 5.75117595723917e-05, 5.06652571543688e-05, 4.45681997081559e-05, 3.91776187493237e-05, 3.43905130282539e-05, 
        3.01461756999552e-05, 2.6389067789241e-05, 2.30685045283832e-05, 2.48237999980932e-05, 2.67019149647715e-05, 2.8710516043447e-05, 
        3.08576719430777e-05, 3.31518684916818e-05, 3.648795456209e-05, 4.01290030789628e-05, 4.40993953251178e-05, 4.84250842452279e-05, 
        5.31336566408207e-05, 5.49769852915523e-05, 5.68783693322731e-05, 5.88394007684626e-05, 6.08617061832891e-05, 6.29469471496298e-05, 
        7.20734006762211e-05, 8.23757153434274e-05, 9.39811723827156e-05, 0.00010702707936232, 0.000121660999767725, 0.000146874940582858, 
        0.000176578648450971, 0.000211398498332376, 0.000252010246553666, 0.000299134688444365, 0.00032236677997206, 0.000347103640519386, 
        0.000373414968120339, 0.000401371229402238, 0.000431043428638356, 0.000478925066322049, 0.000531068293441935, 0.000587711159105986, 
        0.000649086881759051, 0.00071542105070477, 0.000768678992676433, 0.000824942083800123, 0.000884290591197621, 0.000946798638553866, 
        0.00101253333327556, 0.00103498214217924, 0.00105779441931759, 0.00108097210534147, 0.00110451702949978, 0.00112843090588814, 
        0.00118617727038814, 0.00124597766555006, 0.00130784444716559, 0.0013717856541221, 0.00143780475282591, 0.00148595279203643, 
        0.00153515304718063, 0.00158540258500125, 0.00163669709408683, 0.00168903084251181, 0.00167861627230098, 0.00166824265239874, 
        0.00165791003268213, 0.00164761846075199, 0.0016373679819465, 0.00161648894890244, 0.00159577804592179, 0.00157523570019098, 
        0.00155486230087158, 0.00153465819950991, 0.00160586205668667, 0.00167912244778164, 0.0017544191082351, 0.00183172589618411, 
        0.00191101059853496, 0.00202695727060328, 0.00214672089851798, 0.00227014527556697, 0.00239704632517155, 0.00252721158433294, 
        0.00254058912419849, 0.00255399634514573, 0.00256743296797448, 0.00258089871058228, 0.00259439328796769, 0.00255434238781052, 
        0.00251455778332114, 0.00247504661782489, 0.00243581580028159, 0.00239687200511607, 0.00239704632517155, 0.00239722063038837, 
        0.00239739492076798, 0.00239756919631181, 0.0023977434570213, 0.00250158803856576, 0.00260739923589691, 0.00271504346531762, 
        0.00282437538175463, 0.0029352379668665, 0.00317562217184125, 0.00342031104212684, 0.00366729160878367, 0.00391435898312599, 
        0.00415914472781616, 0.00441284132641644, 0.00465816490031672, 0.00489199461415468, 0.00511122034779062, 0.00531281123673254, 
        0.00545563673214177, 0.00558474574831837, 0.00569897431628441, 0.00579727642556817, 0.00587874025053437, 0.00590360968635802, 
        0.00592620034842319, 0.00594648534272231, 0.00596444052165977, 0.0059800445329244, 0.00594650359943667, 0.00590366632381215, 
        0.00585174287563133, 0.0057909859857383, 0.00572168886115623, 0.00561095020944241, 0.005485143914292, 0.00534541258670214, 
        0.00519300139443008, 0.00502923935532701, 0.00491856509034514, 0.00480414637808572, 0.0046863693405364, 0.00456562346762432, 
        0.00444229948038648, 0.00440068601842962, 0.00435884382627211, 0.00431678724490874, 0.00427453056359203, 0.00423208801196198, 
        0.00428852200840476, 0.00434462303939962, 0.00440035742038673, 0.00445569128009307, 0.00451059059367526, 0.00463266193054033, 
        0.00475192435525046, 0.00486798720556, 0.00498046242167099, 0.00508896671044201, 0.0052488854585677, 0.00539694987854826, 
        0.00553186063884978, 0.00565240974847074, 0.00575749882581845, 0.00585183706194928, 0.00592630006400608, 0.00598007893121635, 
        0.00601258488412959, 0.00602346019849159, 0.00601528910661481, 0.0059908410020847, 0.00595031440440921, 0.00589403974275826, 
        0.00582247478160602, 0.00577109296325271, 0.00571429948036774, 0.00565226688888731, 0.00558518222132085, 0.0055132460311947, 
        0.00550392336701915, 0.00549452864140924, 0.00548506228634905, 0.00547552473654979, 0.00546591642941626, 0.00545623780501272, 
        0.0054464893060289, 0.00543667137774584, 0.00542678446800134, 0.00541682902715562, 0.00533477322875143, 0.00524859847175296, 
        0.0051585508652215, 0.00506488421706367, 0.00496785883039748, 0.00480362885503525, 0.00463237238104266, 0.00445526501026151, 
        0.00427348419647754, 0.0040881963587598, 0.00392976872811619, 0.00377034853570806, 0.00361058433905801, 0.00345109800998189, 
        0.00329248115645002, 0.00317771221283125, 0.00306389161335202, 0.00295121358178693, 0.00283986146755658, 0.00273000742000383, 
        0.00274363034929745, 0.00275727896408434, 0.0027709529597296, 0.00278465202876286, 0.00279837586088291, 0.00288122114625753, 
        0.00296487657833234, 0.00304926879803577, 0.00313432090499978, 0.0032199525321701, 0.00334945800974429, 0.00347977304316521, 
        0.00361058433905801, 0.00374156402068568, 0.00387237081753587, 0.00395908589664034, 0.00404547335207739, 0.00413142455580787, 
        0.00421682913462305, 0.00430157519286838, 0.00425935005853486, 0.00421694836401896, 0.00417438418305446, 0.00413167150582425, 
        0.00408882423170217, 0.00398809718279704, 0.00388686400830585, 0.00378529554554936, 0.00368355876409792, 0.00358181634590734, 
        0.0035092274588486, 0.00343677243787654, 0.00336450593156654, 0.00329248115645002, 0.0032207498434293, 0.00317803349824289, 
        0.00313545380148868, 0.00309302096485263, 0.0030507449873885, 0.0030086356529082, 0.00292462131559253, 0.00284137881388778, 
        0.00275897969936548, 0.00267749190078025, 0.00259697968050814, 0.00257036964383394, 0.00254387691619078, 0.00251750360305407, 
        0.00249125176389916, 0.00246512341218323, 0.00261032801920067, 0.00275897969936548, 0.0029106919887969, 0.00306503705792742, 
        0.00322154672174098, 0.00342306742998823, 0.00362613894088144, 0.00382954191373461, 0.00403197915310376, 0.00423208801196198, 
        0.00435884382627211, 0.00448366982739815, 0.00460617784612911, 0.00472597750338438, 0.00484267825388141, 0.00488082259455471, 
        0.00491856509034514, 0.00495589149086578, 0.00499278761408406, 0.00502923935532701, 0.0050049882643988, 0.0049805375872833, 
        0.00495589149086578, 0.00493105415849992, 0.00490602978882006, 0.00484267825388141, 0.00477825025324196, 0.00471281232873159, 
        0.00464643129701428, 0.00457917413637869, 0.00446980188781971, 0.00435862027618243, 0.00424590228209917, 0.00413191839230916, 
        0.0040169355455398, 0.00387223530143578, 0.00372688696936793, 0.0035813742037555, 0.00343616202094295, 0.0032916945909839, 
        0.00304943288749831, 0.00281246250733632, 0.00258245250473096, 0.00236083794867328, 0.00214881486962259, 0.00193565179960644, 
        0.00173517324252725, 0.0015479599436181, 0.00137433403779853, 0.00121438266410766, 0.00110745223050352, 0.00100747770308878, 
        0.000914309497474506, 0.000827760769502428, 0.000747613038506144, 0.000695667191263208, 0.000646591588850452, 0.000600294925075961, 
        0.000556682577717079, 0.000515657329363698, 0.000498228438150675, 0.000481282219159737, 0.000464809838530806, 0.000448802433452028, 
        0.000433251121981608, 0.000425643722850949, 0.000418147012523682, 0.000410759879539564, 0.000403481212957037, 0.00039630990261956, 
        0.000389244839416425, 0.000382284915538218, 0.000375429024726868, 0.000368676062520276, 0.000362024926491646, 0.000352236740614499, 
        0.00034267148660988, 0.000333325476543988, 0.00032419503843338, 0.000315276517810578, 0.000300873379698984, 0.000287032109690126, 
        0.000273736181675312, 0.000260969261394194, 0.000248715221642222, 0.000236899102135082, 0.000225568270488139, 0.00021470717426475, 
        0.000204300515633791, 0.000194333261475656, 0.000188537583013631, 0.000182892500415739, 0.000177394892450943, 0.000172041675470149, 
        0.000166829803906184, 0.000164910552772273, 0.000163009869620058, 0.000161127619688773, 0.000159263668663281, 0.00015741788267899, 
        0.000145112514680971, 0.000133665733194273, 0.000123027392662584, 0.000113149381080724, 0.000103985620718218, 9.54013578607801e-05, 
        8.74569802389998e-05, 8.0111528886487e-05, 7.33260276701514e-05, 6.70634475740575e-05, 6.19661081711859e-05, 5.72221595052997e-05, 
        5.2810131547339e-05, 4.87095982767482e-05, 4.49011489181506e-05, 4.13351341007035e-05, 3.80293637641402e-05, 3.49669554629328e-05, 
        3.21319349320482e-05, 2.95092034173063e-05, 2.84910313406312e-05, 2.75055435654885e-05, 2.65517893463294e-05, 2.56288417561696e-05, 
        2.47357972358425e-05, 2.38320109892266e-05, 2.29587660879188e-05, 2.21151337151516e-05, 2.13002091667859e-05, 2.05131113856265e-05, 
        2.05131113856265e-05, 2.05131113856265e-05, 2.05131113856265e-05, 2.05131113856265e-05, 2.05131113856265e-05, 1.97444812140607e-05, 
        1.90025153069593e-05, 1.82863791910731e-05, 1.75952608228355e-05, 1.69283701304201e-05, 1.40011349767319e-05, 1.1551660323189e-05, 
        1.13041787798391e-05, 1.30376966580375e-05, 1.50164926446004e-05, 1.57836443994641e-05, 1.6587271062449e-05, 1.7428948807432e-05, 
        1.83103130780989e-05, 1.92330603396883e-05, 1.78489346436936e-05, 1.65579114106279e-05, 1.53542654162691e-05, 1.42325805581813e-05, 
        1.31877365047497e-05, 1.17403199917154e-05, 1.0442364398084e-05))
    expect_equal(Bchron:::hdr(date = currdate, prob = prob/100), list(`94.4%` = c(3590, 3833)))
})

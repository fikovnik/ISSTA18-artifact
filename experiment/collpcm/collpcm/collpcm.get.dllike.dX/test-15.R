library(testthat)

.Random.seed <<- .ext.seed

test_that("collpcm.get.dllike.dX", {
    XX <- structure(c(3.38925609110708, 3.31816691129732, 2.99401881922624, 4.79107466759557, 3.83530349492191, 3.17842329153792, 
        2.00558200436358, 0.400838332607079, 0.853302816362634, 0.374888985910499, 0.482722108757235, 0.294145187045868, 
        0.310890823763804, -0.110909112262615, 2.61054322544663, 2.00785166374891, 2.08684950647899, 2.06588804838667, -2.01757470718065, 
        -0.405885301119146, -3.45931969604827, -1.53167134859515, -1.00938209580667, -0.703890044220731, -2.734322539584, 
        -0.41265435140857, 0.0518504673619917, -0.0108502534518051, -0.161597397233158, -0.330209532884092, -0.296318655563142, 
        -1.37032111219327, 2.83100384756527, 2.94984991042985, 4.00238727311579, 2.56016243583568), .Dim = c(18L, 2L))
    dllike.deta <- structure(c(-0.00399509002883192, 0.196719262585647, 0.157450165591016, 0.117754320488918, 0.0837760350713889, 
        0.078902094475897, 0.20126681680413, 0.0474247966819033, 0.0555502110461284, 0.065484880780305, 0.0649555923837854, 
        0.0565796338750109, 0.0535952161879473, 0.0662524639299168, 0.0460274945490239, 0.0350919744832547, 0.0407677045684513, 
        0.0287149518885881, 0.196719262585647, -0.00399509002883192, 0.459530017460112, 0.19899914225407, -0.00997661161222008, 
        -0.103181026435203, 0.406460147831843, 0.0415420190393677, 0.00461824663721072, 0.0474874041327156, 0.0479612373583212, 
        0.0512984032816171, 0.0450069007176811, 0.108420221760817, -0.0200609266867006, -0.0126559236885982, 0.027621865642917, 
        -0.0437646319229393, 0.157450165591016, 0.459530017460112, -0.00399509002883192, 0.355476315749781, 0.360663759763632, 
        0.365228359988832, 0.117672162914267, 0.102380984356075, 0.126070811443942, 0.114946035733723, 0.121341119803646, 
        0.106179376290022, 0.10376678524629, 0.0981238157986255, 0.0577366668746654, 0.04568532080083, 0.0434189151111357, 
        0.045461641267294, 0.117754320488918, 0.19899914225407, 0.355476315749781, -0.00399509002883192, 0.0752845017478353, 
        0.158235608225086, 0.400419017909282, 0.0800152693078824, 0.0838577936836531, 0.0838000626177427, 0.0893794945025117, 
        0.081089373002898, 0.0794720913859967, 0.0941268262349343, 0.0289690268138633, 0.0258889248573757, 0.0309046457471165, 
        0.0210227051369278, 0.0837760350713889, -0.00997661161222008, 0.360663759763632, 0.0752845017478353, -0.00399509002883192, 
        -0.0398537797946652, 0.365628828219067, 0.032449925539392, 0.0189282048620047, 0.0415807119858612, 0.0418918775677481, 
        0.0408807417640681, 0.0365652748097096, 0.0693249610843588, 0.00334782551037326, 0.00571044706636964, 0.0245159824058267, 
        -0.00931948102247874, 0.078902094475897, -0.103181026435203, 0.365228359988832, 0.158235608225086, -0.0398537797946652, 
        -0.00399509002883192, 0.328064931330936, 0.0207873094219, -0.0131648628796971, 0.0314567738237394, 0.0308075038005977, 
        0.0348629139381798, 0.0268429317922742, 0.0957829019614458, -0.0105150218058855, -0.00547848392722631, 0.0270915597420468, 
        -0.0311222476147979, 0.20126681680413, 0.406460147831843, 0.117672162914267, 0.400419017909282, 0.365628828219067, 
        0.328064931330936, -0.00399509002883192, 0.0163953555821365, 0.0626522520170011, 0.0571594430373345, 0.0523623569091743, 
        0.0312308364140039, 0.0293795205112588, -0.0184858487681531, 0.058657469759387, 0.0452244556828771, 0.0456771676197341, 
        0.0422325849071543, 0.0474247966819033, 0.0415420190393677, 0.102380984356075, 0.0800152693078824, 0.032449925539392, 
        0.0207873094219, 0.0163953555821365, -0.00399509002883192, 0.0533019648489645, 0.00698870910704741, -0.0297839836940815, 
        -0.0518228122259168, -0.0443521275227534, 0.135980573810376, 0.106140697947095, 0.101146159137407, 0.120132211885543, 
        0.077365680099733, 0.0555502110461284, 0.00461824663721072, 0.126070811443942, 0.0838577936836531, 0.0189282048620047, 
        -0.0131648628796971, 0.0626522520170011, 0.0533019648489645, -0.00399509002883192, 0.0197968779621519, 0.00355845521941001, 
        0.0476734404955437, 0.0426482169722339, 0.273862751354302, 0.0720385068507937, 0.0618546246259824, 0.110220349732581, 
        0.0208789990277878, 0.065484880780305, 0.0474874041327156, 0.114946035733723, 0.0838000626177427, 0.0415807119858612, 
        0.0314567738237394, 0.0571594430373345, 0.00698870910704741, 0.0197968779621519, -0.00399509002883192, -0.0432251758105082, 
        -0.0192407354360909, -0.0144599714544122, 0.218755361769637, 0.0998916476696507, 0.0912254964280625, 0.122174843527066, 
        0.0597009171959377, 0.0649555923837854, 0.0479612373583212, 0.121341119803646, 0.0893794945025117, 0.0418918775677481, 
        0.0308075038005977, 0.0523623569091743, -0.0297839836940815, 0.00355845521941001, -0.0432251758105082, -0.00399509002883192, 
        -0.0328274434562725, -0.0514299423509283, 0.189947504624206, 0.0878363222169136, 0.0792063999574599, 0.109260502666486, 
        0.0489145231772292, 0.0565796338750109, 0.0512984032816171, 0.106179376290022, 0.081089373002898, 0.0408807417640681, 
        0.0348629139381798, 0.0312308364140039, -0.0518228122259168, 0.0476734404955437, -0.0192407354360909, -0.0328274434562725, 
        -0.00399509002883192, -0.0826069920021575, 0.135634122633507, 0.0974662169772159, 0.0915408348955714, 0.111475398951023, 
        0.0669857015700123, 0.0535952161879473, 0.0450069007176811, 0.10376678524629, 0.0794720913859967, 0.0365652748097096, 
        0.0268429317922742, 0.0293795205112588, -0.0443521275227534, 0.0426482169722339, -0.0144599714544122, -0.0514299423509283, 
        -0.0826069920021575, -0.00399509002883192, 0.151768753731618, 0.110328346889897, 0.105365564442466, 0.125264669020816, 
        0.0796864844542463, 0.0662524639299168, 0.108420221760817, 0.0981238157986255, 0.0941268262349343, 0.0693249610843588, 
        0.0957829019614458, -0.0184858487681531, 0.135980573810376, 0.273862751354302, 0.218755361769637, 0.189947504624206, 
        0.135634122633507, 0.151768753731618, -0.00399509002883192, 0.132907264987898, 0.134018831383161, 0.126859867162161, 
        0.125829153182204, 0.0460274945490239, -0.0200609266867006, 0.0577366668746654, 0.0289690268138633, 0.00334782551037326, 
        -0.0105150218058855, 0.058657469759387, 0.106140697947095, 0.0720385068507937, 0.0998916476696507, 0.0878363222169136, 
        0.0974662169772159, 0.110328346889897, 0.132907264987898, -0.00399509002883192, -0.0240745642209209, 0.137764794508704, 
        -0.00544414428740081, 0.0350919744832547, -0.0126559236885982, 0.04568532080083, 0.0258889248573757, 0.00571044706636964, 
        -0.00547848392722631, 0.0452244556828771, 0.101146159137407, 0.0618546246259824, 0.0912254964280625, 0.0792063999574599, 
        0.0915408348955714, 0.105365564442466, 0.134018831383161, -0.0240745642209209, -0.00399509002883192, 0.115389099680762, 
        -0.0312666369662356, 0.0407677045684513, 0.027621865642917, 0.0434189151111357, 0.0309046457471165, 0.0245159824058267, 
        0.0270915597420468, 0.0456771676197341, 0.120132211885543, 0.110220349732581, 0.122174843527066, 0.109260502666486, 
        0.111475398951023, 0.125264669020816, 0.126859867162161, 0.137764794508704, 0.115389099680762, -0.00399509002883192, 
        0.213873381297945, 0.0287149518885881, -0.0437646319229393, 0.045461641267294, 0.0210227051369278, -0.00931948102247874, 
        -0.0311222476147979, 0.0422325849071543, 0.077365680099733, 0.0208789990277878, 0.0597009171959377, 0.0489145231772292, 
        0.0669857015700123, 0.0796864844542463, 0.125829153182204, -0.00544414428740081, -0.0312666369662356, 0.213873381297945, 
        -0.00399509002883192), .Dim = c(18L, 18L), .Dimnames = list(c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", 
        "11", "12", "13", "14", "15", "16", "17", "18"), c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", 
        "13", "14", "15", "16", "17", "18")))
    expect_equal(collpcm:::collpcm.get.dllike.dX(X = XX, dllike.deta = dllike.deta), structure(c(-0.970665725839064, -0.734206594876883, 
        -0.27276491289142, -3.41365759274718, -1.18224171779237, -0.663617832433235, 2.33939278247518, 1.00955118255045, 
        0.0695134029366906, 0.931894759191133, 1.05404093206114, 0.804960807191228, 0.929271420147951, 2.42492018900596, 
        -0.842776863034027, -0.57824703468189, -0.416834272613821, -0.488532928649847, 0.971935404553423, -2.17553910149462, 
        4.84547369195041, 0.0313008365863062, -1.32701746823091, -1.78595136353757, 2.93428107039878, 0.0951244991825064, 
        -0.623696044402066, -0.102758946523831, -0.11820925738028, -0.0596816549247304, 0.295609506358967, 2.88981189746714, 
        -1.2294635014341, -1.15654544358777, -2.91036422079881, -0.574309904182849), .Dim = c(18L, 2L)))
})

library(testthat)

.Random.seed <<- .ext.seed

test_that("payoff", {
    X <- list(opt = list(nAsset = 2, payType = 0, exerType = 0, pcFlag = c(0, 0), ttm = 0.5, strike = c(110, 90), rf = 0.1, 
        q = c(0.05, 0.04), vol = c(0.2, 0.25), rho = structure(c(1, -0.5, -0.5, 1), .Dim = c(2L, 2L))), fd = list(m = c(10, 
        10), leftBound = c(0, 0), kMult = c(0, 0), density = c(5, 5), kShift = c(1, 1), theta = 0.5, maxSmooth = 2, tol = 1e-07, 
        maxIter = 3), time = list(tsType = 0, N = 40, dtInit = 0.025, dNorm = 2.5, D = 0.05))
    S <- list(c(1.41122811922363e-14, 38.8901424676814, 64.7795881573552, 82.4529275129584, 95.176344430696, 105.301234909097, 
        114.698765090903, 125.105678730439, 138.445262256757, 157.182784514588, 184.781099479737), c(1.36699402358543e-14, 
        32.4711602795384, 53.5322848338762, 67.6250426770314, 77.7215147001502, 85.9509882933852, 94.0490117066148, 103.723411109165, 
        117.014461223531, 136.725167430761, 167.012403347893))
    expect_equal(multiAssetOptions:::payoff(payType = X$opt$payType, pcFlag = X$opt$pcFlag, strike = X$opt$strike, S = S), 
        structure(c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
            0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 
            1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1), .Dim = c(11L, 11L)))
})

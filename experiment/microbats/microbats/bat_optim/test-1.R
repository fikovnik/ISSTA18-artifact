library(testthat)

.Random.seed <<- .ext.seed

test_that("bat_optim", {
    quad_func <- genthat::with_env(function(D, sol) {
        val <- 0
        for (i in 1:D) {
            val <- val + sol[i] * sol[i] - sol[i] * 3
        }
        return(val)
    }, env = list2env(list(), parent = baseenv()))
    expect_equal(microbats:::bat_optim(D = 1, NP = 20, N_Gen = 100, A = 0.5, r = 0.5, Qmin = 0, Qmax = 2, Lower = -10, Upper = 10, 
        FUN = quad_func), list(min_fitness = -2.24999999999867, population_solutions = structure(c(1.50002229346379, 1.50000327092282, 
        1.49981624192912, 1.50000340237423, 1.50000115491296, 1.49999478382729, 1.50006321358638, 1.50002618606652, 1.5001067689293, 
        1.49996158458254, 1.49999680498968, 1.49988737404096, 1.50007178208452, 1.50004308555725, 1.50010422161872, 1.49996645884521, 
        1.49990354289041, 1.49995156521753, 1.5000474246499, 1.50017416079165), .Dim = c(20L, 1L)), fitness = structure(c(-2.249999999503, 
        -2.2499999999893, -2.24999996623297, -2.24999999998842, -2.24999999999867, -2.24999999997279, -2.24999999600404, 
        -2.24999999931429, -2.2499999886004, -2.24999999852426, -2.24999999998979, -2.24999998731539, -2.24999999484733, 
        -2.24999999814364, -2.24999998913785, -2.24999999887499, -2.24999999069603, -2.24999999765407, -2.2499999977509, 
        -2.24999996966802), .Dim = c(1L, 20L)), best_solution = structure(1.50000115491296, .Dim = c(1L, 1L))))
})

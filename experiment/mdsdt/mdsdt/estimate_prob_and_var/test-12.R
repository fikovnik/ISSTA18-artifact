library(testthat)

.Random.seed <<- .ext.seed

test_that("estimate_prob_and_var", {
    ypar <- c(3, 4)
    xpar <- 1:2
    rpar <- c(5, 6, 7, 8)
    ps_new <- structure(c(-1.04088517575794, 1.09247179701, -0.496372464829015, 0.391664617794278, -0.196493283531003, 0.0623850137697199, 
        -0.163838660958472, -0.195845069416469), .Dim = c(8L, 1L))
    expect_equal(mdsdt:::estimate_prob_and_var(xpar = xpar, ypar = ypar, rpar = rpar, ps_old = ps_new), list(prob = structure(c(0.57212488982204, 
        0.301146314831034, 0.081516414771297, 0.0325372257372343, 0.278910688879614, 0.54988926387062, 0.055796475366935, 
        0.104775664400998, 0.118059285992947, 0.0465067033689172, 0.608667761043691, 0.315115792462717, 0.0309051353053982, 
        0.102457717929428, 0.254019348818077, 0.54757131739905), .Dim = c(4L, 4L)), v = structure(c(-0.176996947437656, -0.0751157930955338, 
        -0.137543298274972, -0.0589618517468188, -0.0550862161610734, -0.156967370503195, -0.0821141835102462, -0.160695630038399, 
        0.176996947437656, 0.0751157930955338, 0.137543298274972, 0.0589618517468188, 0.0550862161610734, 0.156967370503195, 
        0.0821141835102462, 0.160695630038399, -0.309386779149483, -0.316688973594096, -0.0538513398319208, -0.0430742744927209, 
        0.309386779149483, 0.316688973594096, 0.0538513398319208, 0.0430742744927209, -0.0433153711332674, -0.0527982489374463, 
        -0.29885081045083, -0.326412948038821, 0.0433153711332674, 0.0527982489374463, 0.29885081045083, 0.326412948038821, 
        0.0731381458285342, 0.0835510481849559, 0.0843504809280818, 0.0738461506350399, -0.0731381458285342, -0.0835510481849559, 
        -0.0843504809280818, -0.0738461506350399, -0.0731381458285342, -0.0835510481849559, -0.0843504809280818, -0.0738461506350399, 
        0.0731381458285342, 0.0835510481849559, 0.0843504809280818, 0.0738461506350399), .Dim = c(4L, 4L, 3L))))
})

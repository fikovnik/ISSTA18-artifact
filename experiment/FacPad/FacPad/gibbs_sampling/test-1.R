library(testthat)

.Random.seed <<- .ext.seed

test_that("gibbs_sampling", {
    matrixY <- structure(c(0.669124300324425, 1.98557958545276, -2.62269174556419, 0.0386327783882622, 0.452580013670236, 
        1.31218282477738, 0.631770282949624, -0.363286701944452, -0.472596374365501, -0.586875017613296, -1.13005143290003, 
        -1.41477911579447, 0.693180505677191, -0.540451859894733, -0.477512058490874, 1.66965180589967, 0.92358662691424, 
        -0.433445634382011, 0.406169507606075, -0.467499774797048, 1.20671381516181, 0.151199619394387, -2.72972610770216, 
        1.45193228611699, 0.0333370317992351, 0.163088543440832, -0.171132959360844, 0.800103011525566, 0.564457562656079, 
        0.554418585485764, -0.789336521728655, -0.798387168586343, -0.390051268537326, -1.31269726500018, -0.069509256890213, 
        0.0451958912177602, 0.291684410136015, 0.653185437607407, 0.472224067704175, -0.0249360616801423, -2.19832268635082, 
        -0.273351965071719, -1.33406611130588, 0.0799190786663668, -2.25092262690939, 1.03375701637434, -1.24271942932846, 
        -0.244661463119827, -1.34990059375268, 1.21982220563902, -0.117070888995912, -0.871811929853901, -1.52595681067002, 
        0.884524502412703, -0.130383116342412, -0.201302154282649, -0.98395417029982, 0.628159704326917, -1.40864094857739, 
        -0.832927285269197, -0.726891594277253, -0.488451925571619, 0.012566849497536, 0.196259259743647, 1.38754834375704, 
        -2.01568063952288, -0.847539186733464, -2.46666931083151, 0.629805041338953, -1.19840602927409, -0.485945711965946, 
        1.82676045167098, -0.411448202634276, 0.21014664214045, 1.08475317205744, -0.0739318639605614, -0.55397705716758, 
        2.59494721490747, -0.543551402004088, -0.766288192446667, -0.493100266172211, -1.18852856212744, -1.23755652540077, 
        0.904800054204489, -0.489100453690879, 1.16332882018669, 0.171543178479272, 2.93036530189173, -1.55674157189953, 
        0.424453301975353, -1.24589841522327, -1.35763821515608, -1.17009653706723, 1.24749619135592, -1.82866798208121, 
        0.967232082677139, 0.243789264611526, 0.22999417222809, -0.0864258296950681, 0.508074689637017, -1.33848524939994, 
        -0.888598916480208, -0.457904279425548, 0.60535136773063, -0.630441731731391, 1.30943427078219, 1.5185403554232, 
        2.37788202888052, -0.748948631920373, 0.0983217414517612, -1.51992994969289, -2.10374469132932, 1.15098075273189, 
        0.0712613201426665, 0.906493564353909, 1.860259490693, 0.785123062923809, -0.622735428083989, -0.721858432605605, 
        0.0224499382718409, -0.785374051762524, 1.11087460728524, 2.56078099250769, 0.747777474716708, -1.54075076524836, 
        0.896394249505646, -1.18319147093235, 1.21375324228933, 0.546585618682351, 1.44327114433644, -0.682716149734267, 
        1.14085823538183, 0.752788214807425, -0.770253870365169, 0.536496644385033, 0.511380906840101, -0.184987970254419, 
        0.0839684773614641, 2.84257650707643, -1.80123346481975, -0.389445773964481, -1.44124953671559, 0.406587864582668, 
        -1.08519756618877, -0.28303679220732, -1.17709374384819, -0.261611414783255, -0.545811724293448, 1.54194286003242, 
        -1.25504571639176, 0.596818428739045, 1.29169981828133, 2.1137951369515, 0.803522752440744, -0.538064686307587, 0.689405143947815, 
        0.0404816478211246, -0.0867218831597783, 0.22369226622565, -0.051731249220951, -0.413281017639294, 2.18312458926265, 
        -0.682788382942685, -0.838992861464639, -0.697681943871274, -0.767790612670599, -0.195675115297386, 0.17631180355666, 
        0.268528470766138, -1.16465155797432, 0.79069585359209, -0.14977143693321, -0.533370624879237, 2.1622653204395, 0.939469090022034, 
        -0.434050854956824, 0.712213011074872, 1.72000175153135, 0.754518909862286, -0.200105230842138, 0.593074861655427, 
        -0.575113968951439, -0.487612990919815, 0.465141676701832, 0.710699347033069, -0.604067142302206, -0.377799452895822, 
        1.47241749774526, -0.379665307444952, -0.169653967198816, 0.777069263774246, 0.757143211768737, -0.705398712158555, 
        -0.27720985582832, 0.298073984847136, 0.800676773001858, -0.527090534678361, -0.0371985906522769, -0.801452908135574, 
        -2.19387414182269, 0.0609891741409956, -2.73306589873798, 0.427184499278133, -0.306323957000044, -0.725289113649331, 
        0.716811633780179, -0.510892165700094, 1.84416992684591, -2.02231619599229, 1.23475206556237, -1.25877589971794, 
        0.0957904177897278, 3.59503425624477, 0.187703789261611, -1.16344247965922, 3.08731120766873, 0.817777477472344, 
        0.437721192389205, 0.0996269218147003, -1.09268410557877, -0.641807107578066, 0.055398497040725, -0.630374228831859, 
        -0.926904479829868, -0.0563556090999511, -0.152689186010655, -1.05402544766117, 1.48625187906882, 0.130586897665347, 
        -0.942909506715352, 0.182533421661843, -0.0833444031369475, -0.0672604487221568, 0.370144375308108, 0.149262122597014, 
        -0.857757905057541, 0.11229495198861, 0.585075032530512, -0.0997855738241273, 1.92172490485216, 0.0549688684537778, 
        0.604590881922851, -0.200873616579062, -1.21902252584302, -0.433194693606059, 0.793543347715133, 1.46002191884755, 
        0.431540822845858, -0.0302008502120236, -0.489060140972424, -0.985362949192678, 1.9008237369025, -0.00257501981101528, 
        -1.7720684980462, -0.451362536379539, 1.90926390731231, -0.140482480212155, -0.524142129350176, 0.416175711532722, 
        -1.61181288538821, 0.839106334199043, 1.01027112970624, -0.174347710998722, -0.0294646655063837, -0.261761334285896, 
        -0.0121795459040299, -0.394572158990783, 0.84767232563346, -1.26751306889067, -0.155564005361099, -0.709904965950217, 
        -0.642429357902183, 1.12598135790096, -1.24964356029851, 0.487461934854604, 0.371934665948104, 0.484896605774401, 
        1.11957033166843, -1.76398000167471, 0.930498083280106, -1.95946834604172, 0.802940114316173, 0.451257969138172, 
        -0.134892714212465, -0.164364168501057, 1.29731711140507, -0.221463071795895, 0.517260816913575, 0.0607455909937501, 
        1.00295606333683, 2.33728819891189, 0.253314337540388, 0.805631308133643, 1.46405399771144, -0.97593153782713, -0.418683450354531, 
        0.330321329829182, 0.415311964999743, 2.16977786250465, 0.187987506447695, -0.247841745814006, 2.52148985868199, 
        -0.221543943259554, 0.973040842662071, 1.33936435068091, -1.34848275323389, 0.282815948265779, -0.413557444043818, 
        1.27034253395138, -0.471332646493863, -0.0723698977399166, -0.490927915023192, 1.26335622677475, 1.61562368939231, 
        -0.304900749892762, -0.314890930825548, 0.480841760187937, 1.39189941859019, 0.150480731000453, -0.443563339838073, 
        0.463017199225463, 0.0532409911101299, -0.536001194079404, 1.4869208966756, -1.60171018707838, 0.0637104771753803, 
        -0.543442124445769, 0.365038121534657, 0.939777939723083, 0.284617105739242, 0.33503998353783, -0.17804406846509, 
        1.21774105943305, 0.220169810906309, -1.09178406342667, -1.59549923282694, 0.123066502741815, 0.214200636919343, 
        1.23943881667792, 0.448903045319888, 0.458217901841078, 1.1672698553516, 1.6871848813349, -0.41815227087831, -0.423864604664505, 
        0.736190770327297, -1.29804570196177, 0.0308055643400141, 0.463650374853558, 0.446632826785017, -1.30603951964129, 
        -0.937674325212333, 0.96167748209625, 0.998762550013602, 0.271613260624912, 1.23421977592028, 0.0564797277717859, 
        -0.172128492127547, -0.376405003614753, -0.495170528651556, -0.770449011468503, 0.0838150950807828, -0.659058281931552, 
        -1.29801856382458, -1.67459822599457, 1.16562151063972, 0.180257501100059, -0.55074215173983, -0.780822388535009, 
        -1.37387387982093, 0.749178404748403, -1.41410159823976, 0.468945310222723, -1.04692396464751, 0.920535330522859, 
        0.155879346403949, -1.16567671101075, -0.200066862976601, 1.33858876229944, 2.02469682004453, -0.178834121305555, 
        2.65605530229533, -0.957526068382039, -0.11246365657843, 2.12986724565413, -0.533647494341378, 0.368732511084215, 
        1.86677732427405, -0.133139223134268, 0.199036130309335, 0.849362429821984, 0.416722826791167, -1.10445894546637, 
        -0.368197820611147, -1.00494193334589, -0.723148463595144, 0.352153794177643, 0.144779051006748, -3.07633720330771, 
        1.4057427605311, -0.400144605452338, 0.710824681965181, -0.162234804014633, -0.50319493814697, 1.35023714953496, 
        0.949690806049036, 0.0314346723311963, 0.756342319612806, 1.4266339993089, 1.34693909254628, -2.54601237959645, -0.0865172083890402, 
        0.0377044171408144, 1.02554572419857, -0.217443710037422, 2.73154930535104, -0.551118568848144, 1.29093760224179, 
        -0.0104470745263655, 0.0991988249947533, -0.192617926977179, -1.49252474969067, -0.947262253538647, -0.409152023781557, 
        -0.38179313653248, 0.923124570921551, 0.70225526596232, -1.23168493200012, -0.166850866543099, 1.22438902811637, 
        -0.669787021104008, -0.997449184243275, -0.471475665458202, 1.60662504090919, 1.56621609181858, 0.945013508050451, 
        -0.533803920819895, -0.493352470850745, 0.712177587789395, -0.930388284187229, 0.838676407832058, 0.641976813945599, 
        0.394748842927465, -1.74335021065445, 0.296009251811794, -0.679334603121684, 0.178881657386862, -2.48748478395322, 
        2.11886261633503, -0.735063650877025, -0.624882011284282, 1.1137765922107, -1.07063299442383, 0.778105618050336, 
        -1.21805141172151, -0.476561187763614, 1.62467192759821, -0.0248504559425884, 0.175394290350712, -0.404344516625376, 
        -0.33742647828469, 0.537178361133269, 2.12782459393364, -1.19759001242115, 0.436397756376428, -0.335612115041215, 
        -0.450118178768959, 0.19105869069982, 1.35805855202417, -1.08660273952069, 1.69747595474086, 0.149068389702136, 0.683851069280986, 
        1.25539349964823, -0.437962196801429, -1.07061636655202, -1.2108423654884, -0.611853659605556, 0.325162293824589, 
        0.203393903717136, -0.607044467557462, 1.00913323565325, -0.0401170845788963, -1.12177500010894, -0.990063962708061, 
        1.2934339183734, -0.0208004818000171, 0.913389550206499, -0.429726167120639, 0.10547268115598, -2.8351621345749, 
        1.01386408653006, -0.322062209565761, -0.145301275934157, -1.2189907551514, 1.39096194008808, 1.25966194828547, -2.49821578469471, 
        -0.00877101016101452, 1.47205884352759), .Dim = c(50L, 10L))
    matrixL <- structure(c(0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 
        1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 
        0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 
        0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 
        0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 
        0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 
        0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1), .Dim = c(50L, 5L))
    expect_equal(FacPad:::gibbs_sampling(matrixY = matrixY, matrixL = matrixL, max_iter = 30, thin = 10, file_name = "test_30iter.RData"), 
        NULL)
})

library(testthat)

.Random.seed <<- .ext.seed

test_that("predict.smooth.Pspline", {
    xx <- c(4, 4.21212121212121, 4.42424242424242, 4.63636363636364, 4.84848484848485, 5.06060606060606, 5.27272727272727, 
        5.48484848484848, 5.6969696969697, 5.90909090909091, 6.12121212121212, 6.33333333333333, 6.54545454545454, 6.75757575757576, 
        6.96969696969697, 7.18181818181818, 7.39393939393939, 7.60606060606061, 7.81818181818182, 8.03030303030303, 8.24242424242424, 
        8.45454545454546, 8.66666666666667, 8.87878787878788, 9.09090909090909, 9.3030303030303, 9.51515151515152, 9.72727272727273, 
        9.93939393939394, 10.1515151515152, 10.3636363636364, 10.5757575757576, 10.7878787878788, 11, 11.2121212121212, 11.4242424242424, 
        11.6363636363636, 11.8484848484848, 12.0606060606061, 12.2727272727273, 12.4848484848485, 12.6969696969697, 12.9090909090909, 
        13.1212121212121, 13.3333333333333, 13.5454545454545, 13.7575757575758, 13.969696969697, 14.1818181818182, 14.3939393939394, 
        14.6060606060606, 14.8181818181818, 15.030303030303, 15.2424242424242, 15.4545454545455, 15.6666666666667, 15.8787878787879, 
        16.0909090909091, 16.3030303030303, 16.5151515151515, 16.7272727272727, 16.9393939393939, 17.1515151515152, 17.3636363636364, 
        17.5757575757576, 17.7878787878788, 18, 18.2121212121212, 18.4242424242424, 18.6363636363636, 18.8484848484849, 19.0606060606061, 
        19.2727272727273, 19.4848484848485, 19.6969696969697, 19.9090909090909, 20.1212121212121, 20.3333333333333, 20.5454545454545, 
        20.7575757575758, 20.969696969697, 21.1818181818182, 21.3939393939394, 21.6060606060606, 21.8181818181818, 22.030303030303, 
        22.2424242424242, 22.4545454545455, 22.6666666666667, 22.8787878787879, 23.0909090909091, 23.3030303030303, 23.5151515151515, 
        23.7272727272727, 23.9393939393939, 24.1515151515152, 24.3636363636364, 24.5757575757576, 24.7878787878788, 25)
    speed <- c(4, 4, 7, 7, 8, 9, 10, 10, 10, 11, 11, 12, 12, 12, 12, 13, 13, 13, 13, 14, 14, 14, 14, 15, 15, 15, 16, 16, 
        17, 17, 17, 18, 18, 18, 18, 19, 19, 19, 20, 20, 20, 20, 20, 22, 23, 24, 24, 24, 24, 25)
    sm.spline <- pspline::sm.spline
    dist <- c(2, 10, 4, 22, 16, 10, 18, 26, 34, 17, 28, 14, 20, 24, 28, 26, 34, 34, 46, 26, 36, 60, 80, 20, 26, 54, 32, 40, 
        32, 40, 50, 42, 56, 76, 84, 36, 46, 68, 32, 48, 52, 56, 64, 66, 54, 70, 92, 93, 120, 85)
    expect_equal(pspline:::predict.smooth.Pspline(object = sm.spline(speed, dist), xarg = xx, nderiv = 1), structure(c(3.23354676462976, 
        3.2329944900289, 3.23283423245916, 3.23306599192053, 3.23368976841303, 3.23470556193665, 3.23611337249138, 3.23791320007724, 
        3.24010504469421, 3.2426889063423, 3.24566478502151, 3.24903268073184, 3.25279259347329, 3.25694452324586, 3.26148847004955, 
        3.26642443388436, 3.27175241475028, 3.27747241264733, 3.28358442757549, 3.29009221808074, 3.2972250554667, 3.305118247388, 
        3.31377179384464, 3.3231856948366, 3.33327740428752, 3.34337738180016, 3.35333887879431, 3.36316189526996, 3.37284643122711, 
        3.38245203676676, 3.39214307016763, 3.4019290594459, 3.41181000460155, 3.42178590563458, 3.43181402037407, 3.44185160664907, 
        3.45189866445958, 3.46195519380561, 3.47201394595048, 3.48194988018659, 3.49171769190973, 3.50131738111991, 3.51074894781712, 
        3.52003339354009, 3.5292665378092, 3.53846019398998, 3.54761436208244, 3.55672904208657, 3.56598631410771, 3.5756947027688, 
        3.58585926585053, 3.59648000335291, 3.60755500225678, 3.61896756839344, 3.63064883307317, 3.64259879629598, 3.65481745806185, 
        3.66727355662848, 3.67971352453037, 3.69208178533674, 3.70437833904759, 3.71660318566291, 3.7287085425416, 3.74056252959419, 
        3.75215750159811, 3.76349345855335, 3.77457040045992, 3.78562651956929, 3.79690000813293, 3.80839086615084, 3.82009909362302, 
        3.83201990964393, 3.8440708435929, 3.85622201481025, 3.86847342329598, 3.88082506905011, 3.89325289780489, 3.90564716196386, 
        3.91799433100142, 3.93029440491756, 3.94254738371229, 3.9547532673856, 3.9669120559375, 3.97902374936799, 3.99108834767707, 
        4.00310730192202, 4.01516912659764, 4.02732605976644, 4.03957810142841, 4.05192525158356, 4.06421901141759, 4.07525489054794, 
        4.08476889108253, 4.09276101302138, 4.09923125636448, 4.10417962111182, 4.10760610726342, 4.10951071481926, 4.10989344377936, 
        4.1087542941437), .Dim = c(100L, 1L)))
})
